!function(){"use strict";var e={3:function(e,t,a){a.d(t,{OptimizedAuth:function(){return o}});var i=a(514);class o{constructor(){this.config={versao:"8.12.1-optimized",autoLogin:!0,lembrarUsuario:!0,sistemaEmails:!0,sistemaAdmin:!0,debug:!1,carregarDoFirebase:!0,pathsFirebase:["dados/auth_equipe","auth/equipe"],timeoutCarregamento:3e3,maxTentativasCarregamento:2,cacheCarregamento:3e5,performance:{cacheEnabled:!0,cacheTTL:6e5,debounceDelay:1e3,maxRetries:3}},this.equipe=new Map([["renato",{nome:"Renato Remiro",email:"renatoremiro@biapo.com.br",cargo:"Coordenador Geral",departamento:"Documenta√ß√£o & Arquivo",admin:!0,ativo:!0,telefone:"",dataIngresso:"2024-01-01"}],["bruna",{nome:"Bruna Britto",email:"brunabritto@biapo.com.br",cargo:"Arquiteta",departamento:"Documenta√ß√£o & Arquivo",admin:!1,ativo:!0,telefone:"",dataIngresso:"2024-01-01"}],["alex",{nome:"Alex",email:"alex@biapo.com.br",cargo:"Comprador",departamento:"Suprimentos",admin:!1,ativo:!0,telefone:"",dataIngresso:"2024-01-01"}]]),this.departamentos=["Planejamento & Controle","Documenta√ß√£o & Arquivo","Suprimentos","Qualidade & Produ√ß√£o","Recursos Humanos"],this.state={usuario:null,logado:!1,tentativasLogin:0,ultimoLogin:null,sessaoIniciada:null,equipeCarregadaDoFirebase:!1,ultimoCarregamentoFirebase:null,fonteEquipeAtual:"hardcoded_optimized",departamentosCarregadosDoFirebase:!1,fonteDepartamentosAtual:"hardcoded_optimized",firebaseDisponivel:null,ultimaVerificacaoFirebase:null,cacheCarregamento:null,performanceMetrics:{loginTimes:[],avgLoginTime:0,cacheHits:0,cacheMisses:0}},this.cache=new Map,this.debouncedVerifyFirebase=(0,i.sg)(()=>this._verificarFirebaseReal(),this.config.performance.debounceDelay)}async init(){try{performance.mark("auth-init-start"),this._setupCache(),this.config.carregarDoFirebase&&await this._carregarEquipeDoFirebase(),this.autoLogin()||this.mostrarLogin(),performance.mark("auth-init-end"),performance.measure("auth-init","auth-init-start","auth-init-end")}catch(e){this.mostrarLogin()}}login(e,t){const a=performance.now();try{const t=this._normalizarIdentificador(e),i=this.equipe.get(t);if(!i)return this.mostrarMensagem("Usu√°rio n√£o encontrado na equipe BIAPO","error"),this.state.tentativasLogin++,!1;if(!i.ativo)return this.mostrarMensagem("Usu√°rio inativo no sistema","error"),!1;this.state.usuario={email:i.email,displayName:i.nome,nome:i.nome,primeiroNome:t,cargo:i.cargo,departamento:i.departamento,admin:i.admin,ativo:i.ativo,telefone:i.telefone,dataIngresso:i.dataIngresso,uid:"biapo_"+t,loginTimestamp:(new Date).toISOString()},this.state.logado=!0,this.state.tentativasLogin=0,this.state.ultimoLogin=(new Date).toISOString(),this.state.sessaoIniciada=(new Date).toISOString();const o=performance.now()-a;return this.state.performanceMetrics.loginTimes.push(o),this.state.performanceMetrics.avgLoginTime=this.state.performanceMetrics.loginTimes.reduce((e,t)=>e+t,0)/this.state.performanceMetrics.loginTimes.length,this._integrarComApp(),this._salvarPreferencias(),this.mostrarSistema(),this.mostrarMensagem("Bem-vindo, "+i.nome+"!","success"),this._executarCallbacksLogin(),!0}catch(e){return this.mostrarMensagem("Erro interno no login","error"),!1}}logout(){try{const e=this.state.usuario?this.state.usuario.displayName:"Usu√°rio";return this.state.usuario=null,this.state.logado=!1,this.state.sessaoIniciada=null,this._limparIntegracaoApp(),this.esconderSistema(),this.mostrarLogin(),this.mostrarMensagem("At√© logo, "+e+"!","info"),this._executarCallbacksLogout(),!0}catch(e){return!1}}estaLogado(){return this.state.logado&&null!==this.state.usuario}ehAdmin(){return this.state.usuario&&!0===this.state.usuario.admin}obterUsuario(){return this.state.usuario}listarUsuarios(e){const t=[];for(const[a,i]of this.equipe.entries())e&&!this._aplicarFiltros(i,e)||t.push({id:a,nome:i.nome,email:i.email,cargo:i.cargo,departamento:i.departamento,admin:i.admin,ativo:i.ativo});return t}_normalizarIdentificador(e){return e?(e.includes("@")&&(e=e.split("@")[0]),e.toLowerCase().trim()):""}_integrarComApp(){window.App&&(App.usuarioAtual=this.state.usuario,App.estadoSistema&&(App.estadoSistema.usuarioAutenticado=!0,App.estadoSistema.usuarioEmail=this.state.usuario.email,App.estadoSistema.usuarioNome=this.state.usuario.displayName,App.estadoSistema.modoAnonimo=!1))}_executarCallbacksLogin(){window.dispatchEvent&&window.dispatchEvent(new CustomEvent("biapo-login",{detail:{usuario:this.state.usuario}}))}mostrarMensagem(e,t){if(window.Notifications)switch(t){case"success":Notifications.success&&Notifications.success(e);break;case"error":Notifications.error&&Notifications.error(e);break;case"warning":Notifications.warning&&Notifications.warning(e);break;default:Notifications.info&&Notifications.info(e)}}mostrarSistema(){try{this._esconderTodasTelasLogin();const e=document.getElementById("mainContainer");e&&(e.style.display="block",e.classList.remove("hidden")),this._atualizarInterfaceUsuario()}catch(e){}}esconderSistema(){const e=document.getElementById("mainContainer");e&&(e.style.display="none",e.classList.add("hidden"))}mostrarLogin(){this.esconderSistema()}_esconderTodasTelasLogin(){document.querySelectorAll('[id*="login"], .auth-login-screen').forEach(e=>e.remove())}_atualizarInterfaceUsuario(){if(!this.state.usuario)return;const e=document.getElementById("usuarioLogado");e&&(e.textContent="üë§ "+this.state.usuario.displayName)}_salvarPreferencias(){this.config.lembrarUsuario&&(localStorage.setItem("ultimoUsuarioBiapo",this.state.usuario.primeiroNome),localStorage.setItem("lembrarUsuarioBiapo","true"))}_limparIntegracaoApp(){window.App&&(App.usuarioAtual=null,App.estadoSistema&&(App.estadoSistema.usuarioAutenticado=!1,App.estadoSistema.usuarioEmail=null,App.estadoSistema.usuarioNome=null,App.estadoSistema.modoAnonimo=!0))}_executarCallbacksLogout(){window.dispatchEvent&&window.dispatchEvent(new CustomEvent("biapo-logout"))}_aplicarFiltros(e,t){return(void 0===t.ativo||e.ativo===t.ativo)&&((void 0===t.admin||e.admin===t.admin)&&(!t.departamento||e.departamento===t.departamento))}autoLogin(){try{if(!this.config.autoLogin||this.state.logado)return!1;const e=localStorage.getItem("ultimoUsuarioBiapo"),t="true"===localStorage.getItem("lembrarUsuarioBiapo");return!!(e&&t&&this.equipe.has(e))&&this.login(e)}catch(e){return!1}}}},159:function(e,t,a){a.d(t,{OptimizedCalendar:function(){return i}});class i{constructor(){this.config={versao:"8.12.1-optimized",locale:"pt-BR",firstDayOfWeek:1,showWeekNumbers:!1,enableKeyboard:!0,enableTouch:!0,performance:{virtualScrolling:!0,lazyRender:!0,batchSize:20,cacheSize:100,debounceDelay:100},view:{defaultView:"month",availableViews:["month","week","day"],showHours:!0,hourRange:{start:6,end:22},slotDuration:30}},this.state={currentDate:new Date,selectedDate:null,view:"month",eventos:new Map,tarefas:new Map,cache:new Map,renderedDates:new Set,eventListeners:new Map,performanceMetrics:{renderTimes:[],eventCount:0,cacheHits:0,cacheMisses:0}},this.container=null,this.intersectionObserver=null,this.resizeObserver=null,this.debouncedRender=this._debounce(()=>this._renderCalendar(),this.config.performance.debounceDelay)}init(e="calendario"){try{if(performance.mark("calendar-init-start"),this.container=document.getElementById(e),!this.container)throw new Error(`Container ${e} n√£o encontrado`);this._setupContainer(),this._setupEventListeners(),this._setupObservers(),this._loadInitialData(),this._renderCalendar(),performance.mark("calendar-init-end"),performance.measure("calendar-init","calendar-init-start","calendar-init-end")}catch(e){throw e}}_setupContainer(){this.container.className="calendar-optimized",this.container.innerHTML='\n      <div class="calendar-header">\n        <div class="calendar-nav">\n          <button class="nav-btn" id="prevMonth" title="M√™s anterior">‚Äπ</button>\n          <button class="nav-btn" id="nextMonth" title="Pr√≥ximo m√™s">‚Ä∫</button>\n          <h2 class="calendar-title" id="calendarTitle"></h2>\n        </div>\n        <div class="calendar-controls">\n          <select class="view-selector" id="viewSelector">\n            <option value="month">M√™s</option>\n            <option value="week">Semana</option>\n            <option value="day">Dia</option>\n          </select>\n          <button class="today-btn" id="todayBtn">Hoje</button>\n        </div>\n      </div>\n      <div class="calendar-body" id="calendarBody">\n        \x3c!-- Calend√°rio ser√° renderizado aqui --\x3e\n      </div>\n      <div class="calendar-legend">\n        <div class="legend-item">\n          <span class="legend-color event"></span>\n          <span>Eventos</span>\n        </div>\n        <div class="legend-item">\n          <span class="legend-color task"></span>\n          <span>Tarefas</span>\n        </div>\n      </div>\n    '}_setupEventListeners(){document.getElementById("prevMonth")?.addEventListener("click",()=>{this._navigateMonth(-1)}),document.getElementById("nextMonth")?.addEventListener("click",()=>{this._navigateMonth(1)}),document.getElementById("todayBtn")?.addEventListener("click",()=>{this._goToToday()}),document.getElementById("viewSelector")?.addEventListener("change",e=>{this._changeView(e.target.value)}),this.config.enableKeyboard&&document.addEventListener("keydown",e=>{this._handleKeyboard(e)}),this.config.enableTouch&&this._setupTouchEvents(),document.addEventListener("app-evento-criado",e=>{this._onEventCreated(e.detail.dados)}),document.addEventListener("app-evento-editado",e=>{this._onEventUpdated(e.detail.dados)}),document.addEventListener("app-tarefa-criada",e=>{this._onTaskCreated(e.detail.dados)})}_setupObservers(){"IntersectionObserver"in window&&this.config.performance.lazyRender&&(this.intersectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this._renderDateCell(e.target)})},{rootMargin:"50px"})),"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(()=>{this.debouncedRender()}),this.resizeObserver.observe(this.container))}async _loadInitialData(){try{if(this._checkApp()){const e=App._obterTodosItensUnificados();e.eventos.forEach(e=>{this.state.eventos.set(e.id,e)}),e.tarefas.forEach(e=>{e.aparecerNoCalendario&&this.state.tarefas.set(e.id,e)}),this.state.performanceMetrics.eventCount=this.state.eventos.size+this.state.tarefas.size}}catch(e){}}_renderCalendar(){const e=performance.now();try{this._updateTitle();const t=document.getElementById("calendarBody");if(!t)return;switch(this.state.view){case"month":this._renderMonthView(t);break;case"week":this._renderWeekView(t);break;case"day":this._renderDayView(t)}const a=performance.now();this.state.performanceMetrics.renderTimes.push(a-e)}catch(e){}}_renderMonthView(e){const t=this.state.currentDate.getFullYear(),a=this.state.currentDate.getMonth(),i=new Date(t,a,1),o=new Date(t,a+1,0),s=new Date(i);s.setDate(s.getDate()-(i.getDay()-this.config.firstDayOfWeek+7)%7);const n=new Date(o);n.setDate(n.getDate()+(6-o.getDay()+this.config.firstDayOfWeek)%7),e.innerHTML=`\n      <div class="calendar-grid month-view">\n        ${this._renderWeekHeader()}\n        ${this._renderMonthDays(s,n,a)}\n      </div>\n    `,this.intersectionObserver&&e.querySelectorAll(".day-cell").forEach(e=>{this.intersectionObserver.observe(e)})}_renderWeekHeader(){return`\n      <div class="week-header">\n        ${this._getWeekDayNames().map(e=>`\n          <div class="week-day-header">${e}</div>\n        `).join("")}\n      </div>\n    `}_renderMonthDays(e,t,a){const i=[],o=new Date(e);for(;o<=t;){const e=o.getMonth()===a,t=this._isToday(o),s=this._isSelected(o),n=this._getEventsForDate(o),r=this._getTasksForDate(o);i.push(`\n        <div class="day-cell ${e?"current-month":"other-month"} \n                    ${t?"today":""} ${s?"selected":""}"\n             data-date="${o.toISOString().split("T")[0]}"\n             onclick="OptimizedCalendar._onDateClick('${o.toISOString().split("T")[0]}')">\n          \n          <div class="day-number">${o.getDate()}</div>\n          \n          <div class="day-events">\n            ${this._renderDayItems(n,r)}\n          </div>\n        </div>\n      `),o.setDate(o.getDate()+1)}return i.join("")}_renderDayItems(e,t){const a=[];e.slice(0,3).forEach(e=>{a.push(`\n        <div class="calendar-event" \n             title="${e.titulo}"\n             onclick="OptimizedCalendar._onItemClick('evento', '${e.id}', event)">\n          <span class="event-icon">üìÖ</span>\n          <span class="event-title">${this._truncateText(e.titulo,15)}</span>\n        </div>\n      `)});const i=3-e.length;t.slice(0,i).forEach(e=>{a.push(`\n        <div class="calendar-task" \n             title="${e.titulo}"\n             onclick="OptimizedCalendar._onItemClick('tarefa', '${e.id}', event)">\n          <span class="task-icon">üìù</span>\n          <span class="task-title">${this._truncateText(e.titulo,15)}</span>\n        </div>\n      `)});const o=e.length+t.length-a.length;return o>0&&a.push(`\n        <div class="more-items">+${o} mais</div>\n      `),a.join("")}_getEventsForDate(e){const t=e.toISOString().split("T")[0],a=`events_${t}`;if(this.state.cache.has(a))return this.state.performanceMetrics.cacheHits++,this.state.cache.get(a);const i=Array.from(this.state.eventos.values()).filter(e=>e.data===t).sort((e,t)=>e.horarioInicio&&t.horarioInicio?e.horarioInicio.localeCompare(t.horarioInicio):e.titulo.localeCompare(t.titulo));if(this.state.cache.set(a,i),this.state.performanceMetrics.cacheMisses++,this.state.cache.size>this.config.performance.cacheSize){const e=this.state.cache.keys().next().value;this.state.cache.delete(e)}return i}_getTasksForDate(e){const t=e.toISOString().split("T")[0],a=`tasks_${t}`;if(this.state.cache.has(a))return this.state.performanceMetrics.cacheHits++,this.state.cache.get(a);const i=Array.from(this.state.tarefas.values()).filter(e=>e.dataInicio===t||e.dataFim===t).sort((e,t)=>e.titulo.localeCompare(t.titulo));return this.state.cache.set(a,i),this.state.performanceMetrics.cacheMisses++,i}_navigateMonth(e){const t=new Date(this.state.currentDate);t.setMonth(t.getMonth()+e),this.state.currentDate=t,this.debouncedRender()}_goToToday(){this.state.currentDate=new Date,this.state.selectedDate=new Date,this.debouncedRender()}_changeView(e){this.state.view=e,this.debouncedRender()}_updateTitle(){const e=document.getElementById("calendarTitle");if(!e)return;const t=new Intl.DateTimeFormat(this.config.locale,{year:"numeric",month:"long"});e.textContent=t.format(this.state.currentDate)}_getWeekDayNames(){const e=new Intl.DateTimeFormat(this.config.locale,{weekday:"short"}),t=[];for(let a=0;a<7;a++){const i=new Date(2024,0,this.config.firstDayOfWeek+a);t.push(e.format(i))}return t}_isToday(e){const t=new Date;return e.toDateString()===t.toDateString()}_isSelected(e){return this.state.selectedDate&&e.toDateString()===this.state.selectedDate.toDateString()}_truncateText(e,t){return e.length>t?e.substring(0,t)+"...":e}_checkApp(){return"undefined"!=typeof App&&App._obterTodosItensUnificados}_onEventCreated(e){this.state.eventos.set(e.id,e),this._invalidateCache(),this.debouncedRender()}_onEventUpdated(e){this.state.eventos.set(e.id,e),this._invalidateCache(),this.debouncedRender()}_onTaskCreated(e){e.aparecerNoCalendario&&(this.state.tarefas.set(e.id,e),this._invalidateCache(),this.debouncedRender())}_invalidateCache(){this.state.cache.clear()}_onDateClick(e){this.state.selectedDate=new Date(e),"undefined"!=typeof Events&&Events.mostrarNovoEvento&&Events.mostrarNovoEvento(e)}_onItemClick(e,t,a){a.stopPropagation(),"evento"===e&&"undefined"!=typeof Events&&Events.abrirModalEdicao(t)}_handleKeyboard(e){if(this.container.contains(document.activeElement))switch(e.key){case"ArrowLeft":this._navigateMonth(-1),e.preventDefault();break;case"ArrowRight":this._navigateMonth(1),e.preventDefault();break;case"Home":this._goToToday(),e.preventDefault();break;case"Escape":this.state.selectedDate=null,this.debouncedRender()}}_setupTouchEvents(){let e=0,t=0;this.container.addEventListener("touchstart",a=>{e=a.touches[0].clientX,t=a.touches[0].clientY},{passive:!0}),this.container.addEventListener("touchmove",a=>{if(a.touches.length>1)return;const i=a.touches[0].clientX-e,o=a.touches[0].clientY-t;Math.abs(i)>Math.abs(o)&&Math.abs(i)>50&&(i>0?this._navigateMonth(-1):this._navigateMonth(1),e=a.touches[0].clientX,t=a.touches[0].clientY)},{passive:!0})}_debounce(e,t){let a;return function(...i){clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),e(...i)},t)}}atualizarEventos(){this._loadInitialData(),this.debouncedRender()}irParaData(e){this.state.currentDate=new Date(e),this.debouncedRender()}obterStatus(){return{versao:this.config.versao,view:this.state.view,currentDate:this.state.currentDate.toISOString(),eventCount:this.state.eventos.size,taskCount:this.state.tarefas.size,performanceMetrics:{...this.state.performanceMetrics,avgRenderTime:this.state.performanceMetrics.renderTimes.length>0?this.state.performanceMetrics.renderTimes.reduce((e,t)=>e+t,0)/this.state.performanceMetrics.renderTimes.length:0,cacheHitRate:this.state.performanceMetrics.cacheHits+this.state.performanceMetrics.cacheMisses>0?(this.state.performanceMetrics.cacheHits/(this.state.performanceMetrics.cacheHits+this.state.performanceMetrics.cacheMisses)*100).toFixed(2):0}}}destroy(){this.intersectionObserver&&this.intersectionObserver.disconnect(),this.resizeObserver&&this.resizeObserver.disconnect(),this.state.cache.clear(),this.state.eventListeners.clear()}}const o=new i;"undefined"!=typeof window&&(window.OptimizedCalendar=o,window.Calendar=o,document.addEventListener("DOMContentLoaded",()=>{document.getElementById("calendario")&&o.init()}))},514:function(e,t,a){function i(e,t,a=!1){let i;return function(...o){const s=a&&!i;clearTimeout(i),i=setTimeout(()=>{i=null,a||e(...o)},t),s&&e(...o)}}function o(e,t){let a;return function(...i){a||(e.apply(this,i),a=!0,setTimeout(()=>a=!1,t))}}a.d(t,{sg:function(){return i}}),(e=a.hmd(e)).exports?e.exports={debounce:i,throttle:o}:"undefined"!=typeof window&&(window.debounce=i,window.throttle=o)},557:function(e,t,a){a.d(t,{OptimizedNotifications:function(){return i}});class i{constructor(){this.config={versao:"8.12.1-optimized",defaultDuration:5e3,maxNotifications:5,enableSound:!1,enableAnimations:!0,position:"top-right",autoRemove:!0},this.notifications=new Map,this.container=null,this.soundEnabled=!1,this.queue=[],this.isProcessingQueue=!1}init(){this._createContainer(),this._setupStyles(),this._checkSoundSupport()}_createContainer(){this.container||(this.container=document.createElement("div"),this.container.id="notification-container-optimized",this.container.className="notification-container",document.body.appendChild(this.container))}_setupStyles(){if(document.getElementById("notification-styles-optimized"))return;const e=document.createElement("style");e.id="notification-styles-optimized",e.textContent="\n      .notification-container {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 999999;\n        pointer-events: none;\n        max-width: 400px;\n      }\n\n      .notification-item {\n        background: white;\n        border-radius: 8px;\n        padding: 16px;\n        margin-bottom: 12px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        border-left: 4px solid #3b82f6;\n        pointer-events: auto;\n        transform: translateX(100%);\n        transition: all 0.3s ease;\n        opacity: 0;\n        max-width: 100%;\n        word-wrap: break-word;\n      }\n\n      .notification-item.show {\n        transform: translateX(0);\n        opacity: 1;\n      }\n\n      .notification-item.success {\n        border-left-color: #10b981;\n      }\n\n      .notification-item.error {\n        border-left-color: #ef4444;\n      }\n\n      .notification-item.warning {\n        border-left-color: #f59e0b;\n      }\n\n      .notification-item.info {\n        border-left-color: #3b82f6;\n      }\n\n      .notification-content {\n        display: flex;\n        align-items: flex-start;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .notification-text {\n        flex: 1;\n        font-size: 14px;\n        line-height: 1.4;\n        color: #374151;\n        margin: 0;\n        word-break: break-word;\n      }\n\n      .notification-close {\n        background: none;\n        border: none;\n        font-size: 18px;\n        cursor: pointer;\n        color: #6b7280;\n        padding: 0;\n        margin: 0;\n        min-width: 20px;\n        height: 20px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 4px;\n        transition: background-color 0.2s;\n      }\n\n      .notification-close:hover {\n        background-color: #f3f4f6;\n        color: #374151;\n      }\n\n      .notification-progress {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        height: 2px;\n        background: rgba(59, 130, 246, 0.3);\n        border-radius: 0 0 8px 8px;\n        transition: width linear;\n      }\n\n      @media (max-width: 480px) {\n        .notification-container {\n          top: 10px;\n          right: 10px;\n          left: 10px;\n          max-width: none;\n        }\n\n        .notification-item {\n          margin-bottom: 8px;\n        }\n      }\n    ",document.head.appendChild(e)}_checkSoundSupport(){this.soundEnabled=this.config.enableSound&&"undefined"!=typeof Audio}success(e,t={}){return this._show(e,"success",t)}error(e,t={}){return this._show(e,"error",t)}warning(e,t={}){return this._show(e,"warning",t)}info(e,t={}){return this._show(e,"info",t)}_show(e,t="info",a={}){const i={id:this._generateId(),message:e,type:t,options:{duration:a.duration||this.config.defaultDuration,persistent:a.persistent||!1,showProgress:!1!==a.showProgress,allowClose:!1!==a.allowClose,...a},timestamp:Date.now()};return this.notifications.size>=this.config.maxNotifications&&this._removeOldest(),this.notifications.set(i.id,i),this._render(i),i.options.persistent||setTimeout(()=>{this._remove(i.id)},i.options.duration),i.id}_render(e){this.container||this._createContainer();const t=document.createElement("div");t.className=`notification-item ${e.type}`,t.id=`notification-${e.id}`,t.innerHTML=`\n      <div class="notification-content">\n        <p class="notification-text">${this._escapeHtml(e.message)}</p>\n        ${e.options.allowClose?`<button class="notification-close" onclick="window.Notifications._remove('${e.id}')">&times;</button>`:""}\n      </div>\n      ${e.options.showProgress&&!e.options.persistent?'<div class="notification-progress" style="width: 100%;"></div>':""}\n    `,this.container.appendChild(t),requestAnimationFrame(()=>{t.classList.add("show")}),e.options.showProgress&&!e.options.persistent&&this._animateProgress(t,e.options.duration),this.soundEnabled&&this._playSound(e.type)}_animateProgress(e,t){const a=e.querySelector(".notification-progress");a&&(a.style.transition=`width ${t}ms linear`,requestAnimationFrame(()=>{a.style.width="0%"}))}_remove(e){if(!this.notifications.get(e))return;const t=document.getElementById(`notification-${e}`);t&&(t.classList.remove("show"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)),this.notifications.delete(e)}_removeOldest(){const e=Array.from(this.notifications.values()).sort((e,t)=>e.timestamp-t.timestamp)[0];e&&this._remove(e.id)}_generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}_escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}_playSound(e){try{const t={success:800,error:300,warning:600,info:500}[e]||500,a=new(window.AudioContext||window.webkitAudioContext),i=a.createOscillator(),o=a.createGain();i.connect(o),o.connect(a.destination),i.frequency.setValueAtTime(t,a.currentTime),i.type="sine",o.gain.setValueAtTime(.1,a.currentTime),o.gain.exponentialRampToValueAtTime(.01,a.currentTime+.2),i.start(a.currentTime),i.stop(a.currentTime+.2)}catch(e){}}clear(){this.notifications.clear(),this.container&&(this.container.innerHTML="")}removeById(e){this._remove(e)}updatePosition(e){this.config.position=e,this.container&&this._updateContainerPosition()}_updateContainerPosition(){const e={"top-right":{top:"20px",right:"20px",left:"auto",bottom:"auto"},"top-left":{top:"20px",left:"20px",right:"auto",bottom:"auto"},"bottom-right":{bottom:"20px",right:"20px",left:"auto",top:"auto"},"bottom-left":{bottom:"20px",left:"20px",right:"auto",top:"auto"},"top-center":{top:"20px",left:"50%",transform:"translateX(-50%)",right:"auto",bottom:"auto"}},t=e[this.config.position]||e["top-right"];Object.assign(this.container.style,t)}enableSound(){this.config.enableSound=!0,this._checkSoundSupport()}disableSound(){this.config.enableSound=!1,this.soundEnabled=!1}getStatus(){return{versao:this.config.versao,activeNotifications:this.notifications.size,maxNotifications:this.config.maxNotifications,soundEnabled:this.soundEnabled,position:this.config.position,config:this.config}}}const o=new i;"undefined"!=typeof window&&(o.init(),window.Notifications=o)},968:function(e,t,a){a.d(t,{OptimizedEvents:function(){return i}});class i{constructor(){this.config={versao:"8.12.1-optimized",tipos:[{value:"reuniao",label:"Reuni√£o",icon:"üìÖ",cor:"#3b82f6"},{value:"entrega",label:"Entrega",icon:"üì¶",cor:"#10b981"},{value:"prazo",label:"Prazo",icon:"‚è∞",cor:"#ef4444"},{value:"marco",label:"Marco",icon:"üèÅ",cor:"#8b5cf6"},{value:"reuniao_equipe",label:"Reuni√£o de Equipe",icon:"üë•",cor:"#06b6d4"},{value:"treinamento",label:"Treinamento",icon:"üìö",cor:"#f59e0b"},{value:"outro",label:"Outro",icon:"üìå",cor:"#6b7280"}],status:[{value:"agendado",label:"Agendado",cor:"#3b82f6"},{value:"confirmado",label:"Confirmado",cor:"#10b981"},{value:"concluido",label:"Conclu√≠do",cor:"#22c55e"},{value:"cancelado",label:"Cancelado",cor:"#ef4444"}],integracaoApp:!0,suporteHorariosUnificados:!0,deepLinksAtivo:!0,sincronizacaoCalendar:!0,verificacaoPermissoes:!0,modalEdicaoUnificado:!0,participantesBiapoFallback:["Renato Remiro","Bruna Britto","Alex","Carlos Mendon√ßa (Beto)","Isabella","Eduardo Santos","Nayara","Juliana","Jean","Lara","Nominato"],performance:{cacheEnabled:!0,cacheTTL:18e4,timeoutModal:50,timeoutValidacao:30,maxModalHistory:10}},this.state={modalAtivo:!1,eventoEditando:null,modoEdicao:!1,eventoOriginal:null,participantesSelecionados:[],modoAnonimo:!1,participantesCache:null,ultimaAtualizacaoParticipantes:null,permissoesCache:new Map,ultimaVerificacaoPermissoes:null,ultimaSincronizacao:null,sincronizacaoEmAndamento:!1,deepLinkPendente:null,modalHistory:[],performanceMetrics:{modalOpenTimes:[],submitTimes:[],avgModalOpenTime:0,avgSubmitTime:0}},this.modalInstance=null,this.debounceTimeouts=new Map}init(){performance.mark("events-init-start"),this._setupEventListeners(),this._checkDeepLinks(),performance.mark("events-init-end"),performance.measure("events-init","events-init-start","events-init-end")}_setupEventListeners(){document.addEventListener("keydown",e=>{"Escape"===e.key&&this.state.modalAtivo&&this.fecharModal()}),window.addEventListener("beforeunload",()=>{if(this.state.modalAtivo&&this.state.modoEdicao)return"Voc√™ tem altera√ß√µes n√£o salvas. Deseja realmente sair?"})}_checkDeepLinks(){const e=new URLSearchParams(window.location.search),t=e.get("evento"),a=e.get("acao");t&&"editar"===a&&(this.state.deepLinkPendente={eventoId:t,acao:a},setTimeout(()=>{this.state.deepLinkPendente&&(this.abrirModalEdicao(t),this.state.deepLinkPendente=null)},1e3))}async mostrarNovoEvento(e=null){const t=performance.now();try{if(!this._verificarPermissoes())return void this._mostrarMensagemModoAnonimo("criar evento");const a=new Date,i=e||a.toISOString().split("T")[0];this.state.eventoEditando=null,this.state.modoEdicao=!1,this.state.eventoOriginal=null,this.state.participantesSelecionados=[],await this._prepararParticipantes(),this._criarModalOtimizado(i),this.state.modalAtivo=!0;const o=performance.now();this.state.performanceMetrics.modalOpenTimes.push(o-t),this._updateAvgModalOpenTime()}catch(e){this._mostrarNotificacao("Erro ao abrir modal de evento","error")}}async abrirModalEdicao(e){const t=performance.now();try{const a=this._buscarEvento(e);if(!a)return this._mostrarNotificacao("‚ùå Evento n√£o encontrado","error"),!1;const i=await this._verificarPermissoesEdicao(a);if(!i.permitido)return this._mostrarAlertaPermissao(i.motivo,a),!1;this.state.eventoEditando=e,this.state.modoEdicao=!0,this.state.eventoOriginal={...a},this.state.participantesSelecionados=a.participantes||a.pessoas||[],await this._prepararParticipantes(),this._criarModalOtimizado(a.data,a),this.state.modalAtivo=!0,this._addToModalHistory(a);const o=performance.now();return this.state.performanceMetrics.modalOpenTimes.push(o-t),this._updateAvgModalOpenTime(),!0}catch(e){return this._mostrarNotificacao("Erro ao abrir edi√ß√£o do evento","error"),!1}}async _prepararParticipantes(){const e=Date.now();if(this.state.participantesCache&&this.state.ultimaAtualizacaoParticipantes&&e-this.state.ultimaAtualizacaoParticipantes<this.config.performance.cacheTTL)return this.state.participantesCache;try{let t=this.config.participantesBiapoFallback;if(this._verificarAuth()&&"function"==typeof Auth.listarUsuarios){const e=Auth.listarUsuarios({ativo:!0});e&&e.length>0&&(t=e.map(e=>e.nome).filter(Boolean))}return this.state.participantesCache=t,this.state.ultimaAtualizacaoParticipantes=e,t}catch(e){return this.config.participantesBiapoFallback}}_criarModalOtimizado(e,t=null){if(this.modalInstance)return void this._atualizarModalExistente(e,t);this._removerModal();const a=this.state.modoEdicao&&!!t,i=a?"Editar Evento":"Novo Evento",o=document.createElement("div");o.id="modalEventoOptimizado",o.className="modal-optimized",o.innerHTML=this._gerarHtmlModalOtimizado(i,e,t,a),document.body.appendChild(o),this.modalInstance=o,this._aplicarAnimacaoEntrada(o),this._configurarEventListenersModal(o),setTimeout(()=>{const e=document.getElementById("eventoTituloOpt");e&&(e.focus(),a&&e.select())},this.config.performance.timeoutModal)}_atualizarModalExistente(e,t){if(!this.modalInstance)return;const a=this.modalInstance.querySelector(".modal-content-optimized");if(a){const i=this.state.modoEdicao&&!!t,o=i?"Editar Evento":"Novo Evento";a.innerHTML=this._gerarConteudoModal(o,e,t,i),this._configurarEventListenersModal(this.modalInstance)}}_gerarHtmlModalOtimizado(e,t,a,i){return`\n      <div class="modal-content-optimized">\n        ${this._gerarConteudoModal(e,t,a,i)}\n      </div>\n    `}_gerarConteudoModal(e,t,a,i){const o=this.config.tipos.map(e=>`<option value="${e.value}" ${a?.tipo===e.value?"selected":""}>${e.icon} ${e.label}</option>`).join(""),s=this.state.participantesCache||this.config.participantesBiapoFallback,n=s.map(e=>`\n        <label class="participant-label">\n          <input type="checkbox" name="participantes" value="${e}" ${this.state.participantesSelecionados.includes(e)||a?.pessoas?.includes(e)||a?.participantes?.includes(e)?"checked":""}>\n          <span>${e}</span>\n        </label>\n      `).join("");return`\n      <div class="modal-header-optimized">\n        <div>\n          <h3>${e}</h3>\n          <p>${i?`Editando: "${a?.titulo||"Evento"}"`:"Criando novo evento"} | v${this.config.versao}</p>\n        </div>\n        <button onclick="OptimizedEvents.fecharModal()" class="modal-close-btn">&times;</button>\n      </div>\n      \n      <form id="formEventoOpt" class="modal-form-optimized">\n        <div class="form-grid">\n          <div class="form-group">\n            <label for="eventoTituloOpt">üìù T√≠tulo do Evento *</label>\n            <input type="text" id="eventoTituloOpt" required \n                   value="${a?.titulo||""}"\n                   placeholder="Ex: Reuni√£o de planejamento semanal"\n                   class="form-input-optimized">\n          </div>\n          \n          <div class="form-row">\n            <div class="form-group">\n              <label for="eventoTipoOpt">üìÇ Tipo *</label>\n              <select id="eventoTipoOpt" required class="form-input-optimized">\n                ${o}\n              </select>\n            </div>\n            \n            <div class="form-group">\n              <label for="eventoDataOpt">üìÖ Data *</label>\n              <input type="date" id="eventoDataOpt" required \n                     value="${a?.data||t}"\n                     class="form-input-optimized">\n            </div>\n          </div>\n          \n          <div class="horarios-section">\n            <h4>üïê Hor√°rios</h4>\n            <div class="form-row">\n              <div class="form-group">\n                <label for="eventoHorarioInicioOpt">In√≠cio</label>\n                <input type="time" id="eventoHorarioInicioOpt" \n                       value="${a?.horarioInicio||a?.horario||""}"\n                       class="form-input-optimized">\n              </div>\n              \n              <div class="form-group">\n                <label for="eventoHorarioFimOpt">Fim</label>\n                <input type="time" id="eventoHorarioFimOpt" \n                       value="${a?.horarioFim||""}"\n                       class="form-input-optimized">\n              </div>\n            </div>\n          </div>\n          \n          <div class="form-group">\n            <label for="eventoDescricaoOpt">üìÑ Descri√ß√£o</label>\n            <textarea id="eventoDescricaoOpt" rows="3" \n                      placeholder="Descreva os detalhes do evento..."\n                      class="form-input-optimized">${a?.descricao||""}</textarea>\n          </div>\n          \n          <div class="form-group">\n            <label>üë• Participantes BIAPO (${s.length} usu√°rios)</label>\n            <div class="participants-grid">\n              ${n}\n            </div>\n          </div>\n          \n          <div class="form-group">\n            <label for="eventoLocalOpt">üìç Local</label>\n            <input type="text" id="eventoLocalOpt" \n                   value="${a?.local||""}"\n                   placeholder="Ex: Sala de reuni√µes A1, Online (Teams)"\n                   class="form-input-optimized">\n          </div>\n        </div>\n      </form>\n      \n      <div class="modal-footer-optimized">\n        <button type="button" onclick="OptimizedEvents.fecharModal()" class="btn-secondary">\n          ‚ùå Cancelar\n        </button>\n        \n        ${i?`\n          <button type="button" onclick="OptimizedEvents.confirmarExclusao(${a.id})" class="btn-danger">\n            üóëÔ∏è Excluir\n          </button>\n        `:""}\n        \n        <button type="button" onclick="OptimizedEvents._submeterFormulario()" class="btn-primary">\n          ${i?"‚úÖ Salvar Altera√ß√µes":"üìÖ Criar Evento"}\n        </button>\n      </div>\n    `}async _submeterFormulario(){const e=performance.now();try{const t=document.getElementById("eventoTituloOpt")?.value?.trim(),a=document.getElementById("eventoTipoOpt")?.value,i=document.getElementById("eventoDataOpt")?.value,o=document.getElementById("eventoDescricaoOpt")?.value?.trim()||"",s=document.getElementById("eventoLocalOpt")?.value?.trim()||"",n=document.getElementById("eventoHorarioInicioOpt")?.value||null,r=document.getElementById("eventoHorarioFimOpt")?.value||null;if(!this._validarCamposObrigatorios(t,a,i))return;const c=document.querySelectorAll('input[name="participantes"]:checked'),d={titulo:t,tipo:a,data:i,descricao:o,local:s,horarioInicio:n,horarioFim:r,participantes:Array.from(c).map(e=>e.value),status:"agendado",criadoPor:this._obterUsuarioAtual(),dataCriacao:(new Date).toISOString(),ultimaAtualizacao:(new Date).toISOString()};this.state.modoEdicao&&this.state.eventoEditando&&(d.id=this.state.eventoEditando),await this._salvarEvento(d);const l=performance.now();this.state.performanceMetrics.submitTimes.push(l-e),this._updateAvgSubmitTime(),this.fecharModal()}catch(e){this._mostrarNotificacao("Erro interno ao salvar evento","error")}}async _salvarEvento(e){try{this._verificarApp()&&"function"==typeof App.criarEvento?(this.state.modoEdicao?(await App.editarEvento(this.state.eventoEditando,e),this._mostrarNotificacao("‚úÖ Evento atualizado com sucesso!","success")):(await App.criarEvento(e),this._mostrarNotificacao("‚úÖ Evento criado com sucesso!","success")),await this._sincronizarComApp()):(this._salvarEventoLocal(e),this._mostrarNotificacao("‚úÖ Evento salvo localmente!","success"))}catch(e){throw e}}_validarCamposObrigatorios(e,t,a){return e?t?!!a||(this._mostrarNotificacao("Data do evento √© obrigat√≥ria","error"),document.getElementById("eventoDataOpt")?.focus(),!1):(this._mostrarNotificacao("Tipo do evento √© obrigat√≥rio","error"),document.getElementById("eventoTipoOpt")?.focus(),!1):(this._mostrarNotificacao("T√≠tulo do evento √© obrigat√≥rio","error"),document.getElementById("eventoTituloOpt")?.focus(),!1)}fecharModal(){try{this._aplicarAnimacaoSaida(),setTimeout(()=>{this._removerModal(),this.state.modalAtivo=!1,this.state.eventoEditando=null,this.state.modoEdicao=!1,this.state.eventoOriginal=null,this.state.participantesSelecionados=[],this.modalInstance=null},300)}catch(e){}}_aplicarAnimacaoEntrada(e){e.style.opacity="0",e.style.transform="scale(0.9)",requestAnimationFrame(()=>{e.style.transition="all 0.3s ease",e.style.opacity="1",e.style.transform="scale(1)"})}_aplicarAnimacaoSaida(){this.modalInstance&&(this.modalInstance.style.opacity="0",this.modalInstance.style.transform="scale(0.9)")}_configurarEventListenersModal(e){e.addEventListener("click",t=>{t.target===e&&this.fecharModal()})}_removerModal(){document.querySelectorAll("#modalEventoOptimizado, .modal-optimized").forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)})}_verificarAuth(){return"undefined"!=typeof Auth&&Auth.listarUsuarios}_verificarApp(){return"undefined"!=typeof App}_verificarPermissoes(){try{return this._verificarApp()&&"function"==typeof App.podeEditar?App.podeEditar():!this.state.modoAnonimo}catch(e){return!1}}async _verificarPermissoesEdicao(e){const t=`perm_${e.id}`;if(this.state.permissoesCache.has(t))return this.state.permissoesCache.get(t);try{let a;return a=this._verificarApp()&&"function"==typeof App._verificarPermissoesEdicao?App._verificarPermissoesEdicao(e,"evento"):this._verificarPermissoesLocal(e),this.state.permissoesCache.set(t,a),setTimeout(()=>{this.state.permissoesCache.delete(t)},3e5),a}catch(e){return{permitido:!1,motivo:"Erro ao verificar permiss√µes de edi√ß√£o"}}}_buscarEvento(e){try{return this._verificarApp()&&"function"==typeof App._buscarEvento?App._buscarEvento(e):void 0!==window.eventos&&Array.isArray(window.eventos)?window.eventos.find(t=>t.id==e):null}catch(e){return null}}_obterUsuarioAtual(){try{if(this._verificarApp()&&App.usuarioAtual)return App.usuarioAtual.email||App.usuarioAtual.displayName||"Sistema";if(this._verificarAuth()&&"function"==typeof Auth.obterUsuario){const e=Auth.obterUsuario();return e?.email||e?.displayName||"Sistema"}return"Sistema"}catch(e){return"Sistema"}}_mostrarNotificacao(e,t="info"){try{if("undefined"!=typeof Notifications)switch(t){case"success":Notifications.success&&Notifications.success(e);break;case"error":Notifications.error&&Notifications.error(e);break;case"warning":Notifications.warning&&Notifications.warning(e);break;default:Notifications.info&&Notifications.info(e)}}catch(e){}}_addToModalHistory(e){this.state.modalHistory.unshift({evento:{...e},timestamp:Date.now(),acao:"edicao"}),this.state.modalHistory.length>this.config.performance.maxModalHistory&&this.state.modalHistory.pop()}_updateAvgModalOpenTime(){const e=this.state.performanceMetrics.modalOpenTimes;this.state.performanceMetrics.avgModalOpenTime=e.reduce((e,t)=>e+t,0)/e.length}_updateAvgSubmitTime(){const e=this.state.performanceMetrics.submitTimes;this.state.performanceMetrics.avgSubmitTime=e.reduce((e,t)=>e+t,0)/e.length}async _sincronizarComApp(){try{this._verificarApp()&&"function"==typeof App._salvarDadosUnificados&&await App._salvarDadosUnificados()}catch(e){}}getStatus(){return{versao:this.config.versao,modalAtivo:this.state.modalAtivo,eventoEditando:this.state.eventoEditando,modoEdicao:this.state.modoEdicao,performanceMetrics:this.state.performanceMetrics,cacheStats:{participantes:!!this.state.participantesCache,permissoes:this.state.permissoesCache.size}}}}const o=new i;"undefined"!=typeof window&&(o.init(),window.OptimizedEvents=o,window.Events=o)}},t={};function a(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={id:i,loaded:!1,exports:{}};return e[i](s,s.exports,a),s.loaded=!0,s.exports}a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=a(514);class t{constructor(){this.config={versao:"8.12.1-optimized",ambiente:"production",debugAtivo:!1,sistemaUnificado:!0,estruturaUnificada:!0,firebaseOfflineMode:!0,tentarFirebase:!0,salvarLocalStorage:!0,salvarIndexedDB:!0,suporteHorarios:!0,deepLinksAtivo:!0,syncRealtime:!0,performance:{cacheEnabled:!0,cacheTTL:3e5,maxCacheSize:1e3,debounceDelay:2e3,batchSize:50,lazyLoadThreshold:100}},this.dados={areas:new Map,eventos:new Map,tarefas:new Map,usuarios:new Map,metadata:{versao:this.config.versao,ultimaAtualizacao:null,totalItens:0,indices:new Map}},this.estadoSistema={inicializado:!1,carregando:!1,salvando:!1,modoAnonimo:!1,usuarioAutenticado:!1,usuarioEmail:null,usuarioNome:null,firebaseDisponivel:!1,usandoLocalStorage:!1,usandoIndexedDB:!1,performanceMetrics:{tempoInicializacao:0,tempoCarregamento:0,memoriaUsada:0,operacoesPorSegundo:0}},this.usuarioAtual=null,this.cache=new Map,this.indices={eventosPorData:new Map,tarefasPorUsuario:new Map,tarefasPorStatus:new Map,eventosPorParticipante:new Map},this.debouncedSave=(0,e.sg)(()=>this._salvarDadosUnificados(),this.config.performance.debounceDelay),this.performanceObserver=null,this.idbPromise=null,this._singleton=null,this._initPromise=null}static getInstance(){return t._singleton||(t._singleton=new t),t._singleton}async init(){return this._initPromise||(this._initPromise=this._performInit()),this._initPromise}async _performInit(){const e=performance.now();try{this.estadoSistema.carregando=!0,this._startPerformanceMonitoring(),await this._initIndexedDB(),this.estadoSistema.firebaseDisponivel=await this._verificarFirebase(),this._detectarUsuario(),await this._carregarDados(),this._buildIndices(),this._configurarListeners(),this._configurarServiceWorker();const t=performance.now();return this.estadoSistema.performanceMetrics.tempoInicializacao=t-e,this.estadoSistema.inicializado=!0,this.estadoSistema.carregando=!1,this._dispatchEvent("app-inicializado",{versao:this.config.versao,tempoInicializacao:this.estadoSistema.performanceMetrics.tempoInicializacao}),!0}catch(e){throw this.estadoSistema.carregando=!1,this.config.salvarLocalStorage&&(this._carregarDadosLocal(),this.estadoSistema.inicializado=!0,this.estadoSistema.usandoLocalStorage=!0),e}}async _initIndexedDB(){try{this.estadoSistema.usandoIndexedDB=!1}catch(e){this.estadoSistema.usandoIndexedDB=!1}}async _verificarFirebase(){return new Promise(e=>{const t=setTimeout(()=>e(!1),3e3);try{if("undefined"==typeof firebase||"undefined"==typeof database)return clearTimeout(t),void e(!1);database.ref(".info/connected").once("value",a=>{clearTimeout(t),e(!0===a.val())}).catch(()=>{clearTimeout(t),e(!1)})}catch(a){clearTimeout(t),e(!1)}})}async criarTarefa(e){const t=performance.now();try{if(!e.titulo)throw new Error("T√≠tulo da tarefa √© obrigat√≥rio");const a={id:this._gerarIdUnico("tarefa"),...e,_tipoItem:"tarefa",titulo:e.titulo,descricao:e.descricao||"",tipo:e.tipo||"pessoal",status:e.status||"pendente",prioridade:e.prioridade||"media",escopo:e.escopo||"pessoal",visibilidade:e.visibilidade||"privada",dataInicio:e.dataInicio||(new Date).toISOString().split("T")[0],dataFim:e.dataFim||null,horarioInicio:e.horarioInicio||null,horarioFim:e.horarioFim||null,duracaoEstimada:e.duracaoEstimada||null,horarioFlexivel:!1!==e.horarioFlexivel,lembretesAtivos:!0===e.lembretesAtivos,responsavel:e.responsavel||this.usuarioAtual?.email||"Sistema",participantes:e.participantes||[],progresso:0,tempoGasto:0,aparecerNoCalendario:!0===e.aparecerNoCalendario,criadoPor:this.usuarioAtual?.email||"Sistema",dataCriacao:(new Date).toISOString(),ultimaAtualizacao:(new Date).toISOString(),_origem:`app_otimizado_${this.config.versao}`,_sincronizado:!1,_performanceMetric:performance.now()-t};return this.dados.tarefas.set(a.id,a),this._updateIndices("tarefa",a),this._invalidateCache(["tarefas",`tarefas_${a.responsavel}`]),this.debouncedSave(),this._dispatchEvent("tarefa-criada",a),a}catch(e){throw e}}async editarTarefa(e,t){try{const a=this.dados.tarefas.get(e);if(!a)throw new Error("Tarefa n√£o encontrada");const i={...a,...t,ultimaAtualizacao:(new Date).toISOString(),_sincronizado:!1};return this.dados.tarefas.set(e,i),this._updateIndices("tarefa",i),this._invalidateCache(["tarefas",`tarefas_${i.responsavel}`]),this.debouncedSave(),this._dispatchEvent("tarefa-editada",i),i}catch(e){throw e}}async excluirTarefa(e){try{const t=this.dados.tarefas.get(e);if(!t)throw new Error("Tarefa n√£o encontrada");return this.dados.tarefas.delete(e),this._removeFromIndices("tarefa",t),this._invalidateCache(["tarefas",`tarefas_${t.responsavel}`]),this.debouncedSave(),this._dispatchEvent("tarefa-excluida",{id:e,tarefa:t}),!0}catch(e){throw e}}obterTarefasUsuario(e=null){const t=this._normalizarEmail(e||this.usuarioAtual?.email),a=`tarefas_${t}`;if(this.cache.has(a)&&this._isCacheValid(a))return this.cache.get(a).data;let i;return i=t?Array.from(this.dados.tarefas.values()).filter(e=>this._normalizarEmail(e.responsavel)===t||this._normalizarEmail(e.criadoPor)===t||(e.participantes||[]).map(this._normalizarEmail).includes(t)||"publico"===e.escopo||"publica"===e.visibilidade):Array.from(this.dados.tarefas.values()),this._setCache(a,i),i}async criarEvento(e){try{if(!e.titulo||!e.data)throw new Error("T√≠tulo e data do evento s√£o obrigat√≥rios");const t={id:this._gerarIdUnico("evento"),...e,_tipoItem:"evento",titulo:e.titulo,data:e.data,tipo:e.tipo||"outro",status:e.status||"agendado",descricao:e.descricao||"",local:e.local||"",horarioInicio:e.horarioInicio||null,horarioFim:e.horarioFim||null,participantes:e.participantes||[],criadoPor:e.criadoPor||this.usuarioAtual?.email||"Sistema",dataCriacao:e.dataCriacao||(new Date).toISOString(),ultimaAtualizacao:(new Date).toISOString(),_origem:`app_otimizado_${this.config.versao}`,_sincronizado:!1};return this.dados.eventos.set(t.id,t),this._updateIndices("evento",t),this._invalidateCache(["eventos",`eventos_${t.data}`]),this.debouncedSave(),this._dispatchEvent("evento-criado",t),t}catch(e){throw e}}async _salvarDadosUnificados(){if(!this.estadoSistema.salvando)try{this.estadoSistema.salvando=!0,this.dados.metadata.ultimaAtualizacao=(new Date).toISOString(),this.dados.metadata.totalItens=this.dados.eventos.size+this.dados.tarefas.size;const e=this._serializarDados(),t=[];this.estadoSistema.firebaseDisponivel&&t.push(this._salvarFirebase(e)),this.estadoSistema.usandoIndexedDB&&t.push(this._salvarIndexedDB(e)),this.config.salvarLocalStorage&&t.push(this._salvarDadosLocal(e)),await Promise.allSettled(t),this._markAllSynced()}catch(e){throw this._salvarBackupEmergencia(),e}finally{this.estadoSistema.salvando=!1}}async _salvarIndexedDB(e){}_buildIndices(){this.indices.eventosPorData.clear(),this.indices.tarefasPorUsuario.clear(),this.indices.tarefasPorStatus.clear(),this.indices.eventosPorParticipante.clear();for(const e of this.dados.eventos.values())this._updateIndices("evento",e);for(const e of this.dados.tarefas.values())this._updateIndices("tarefa",e)}_updateIndices(e,t){"evento"===e?(this.indices.eventosPorData.has(t.data)||this.indices.eventosPorData.set(t.data,[]),this.indices.eventosPorData.get(t.data).push(t.id),(t.participantes||[]).forEach(e=>{this.indices.eventosPorParticipante.has(e)||this.indices.eventosPorParticipante.set(e,[]),this.indices.eventosPorParticipante.get(e).push(t.id)})):"tarefa"===e&&(this.indices.tarefasPorUsuario.has(t.responsavel)||this.indices.tarefasPorUsuario.set(t.responsavel,[]),this.indices.tarefasPorUsuario.get(t.responsavel).push(t.id),this.indices.tarefasPorStatus.has(t.status)||this.indices.tarefasPorStatus.set(t.status,[]),this.indices.tarefasPorStatus.get(t.status).push(t.id))}_setCache(e,t){if(this.cache.set(e,{data:t,timestamp:Date.now(),ttl:this.config.performance.cacheTTL}),this.cache.size>this.config.performance.maxCacheSize){const e=this.cache.keys().next().value;this.cache.delete(e)}}_isCacheValid(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl}_invalidateCache(e){e.forEach(e=>this.cache.delete(e))}_startPerformanceMonitoring(){"PerformanceObserver"in window&&(this.performanceObserver=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"measure"===e.entryType&&this.estadoSistema.performanceMetrics.operacoesPorSegundo++})}),this.performanceObserver.observe({entryTypes:["measure","navigation"]})),setInterval(()=>{performance.memory&&(this.estadoSistema.performanceMetrics.memoriaUsada=performance.memory.usedJSHeapSize)},5e3)}async _configurarServiceWorker(){if("serviceWorker"in navigator)try{await navigator.serviceWorker.register("/service-worker.js")}catch(e){}}_serializarDados(){return{areas:Object.fromEntries(this.dados.areas),eventos:Object.fromEntries(this.dados.eventos),tarefas:Object.fromEntries(this.dados.tarefas),usuarios:Object.fromEntries(this.dados.usuarios),metadata:{...this.dados.metadata,indices:Object.fromEntries(this.dados.metadata.indices)}}}_deserializarDados(e){this.dados.areas=new Map(Object.entries(e.areas||{})),this.dados.eventos=new Map(Object.entries(e.eventos||{})),this.dados.tarefas=new Map(Object.entries(e.tarefas||{})),this.dados.usuarios=new Map(Object.entries(e.usuarios||{})),this.dados.metadata={...e.metadata,indices:new Map(Object.entries(e.metadata?.indices||{}))}}_detectarUsuario(){try{if("undefined"!=typeof Auth&&Auth.obterUsuario){const e=Auth.obterUsuario();if(e)return this.usuarioAtual=e,this.estadoSistema.usuarioAutenticado=!0,this.estadoSistema.usuarioEmail=e.email,this.estadoSistema.usuarioNome=e.displayName||e.nome,void(this.estadoSistema.modoAnonimo=!1)}this.estadoSistema.modoAnonimo=!0,this.estadoSistema.usuarioAutenticado=!1}catch(e){this.estadoSistema.modoAnonimo=!0}}_gerarIdUnico(e="item"){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}_normalizarEmail(e){return(e||"").toLowerCase().trim()}_dispatchEvent(e,t){try{const a=new CustomEvent(`app-${e}`,{detail:{tipo:e,dados:t,timestamp:Date.now()}});document.dispatchEvent(a)}catch(e){}}_configurarListeners(){window.addEventListener("biapo-login",e=>{this._detectarUsuario(),this._carregarDados()}),window.addEventListener("biapo-logout",()=>{this.usuarioAtual=null,this.estadoSistema.modoAnonimo=!0,this.estadoSistema.usuarioAutenticado=!1}),setInterval(()=>{this._temMudancasPendentes()&&this.debouncedSave()},6e4)}_temMudancasPendentes(){const e=Array.from(this.dados.eventos.values()).some(e=>!e._sincronizado),t=Array.from(this.dados.tarefas.values()).some(e=>!e._sincronizado);return e||t}_markAllSynced(){for(const e of this.dados.eventos.values())e._sincronizado=!0;for(const e of this.dados.tarefas.values())e._sincronizado=!0}obterStatusSistema(){return{versao:this.config.versao,inicializado:this.estadoSistema.inicializado,firebaseDisponivel:this.estadoSistema.firebaseDisponivel,usandoLocalStorage:this.estadoSistema.usandoLocalStorage,usandoIndexedDB:this.estadoSistema.usandoIndexedDB,modoAnonimo:this.estadoSistema.modoAnonimo,usuarioAutenticado:this.estadoSistema.usuarioAutenticado,totalEventos:this.dados.eventos.size,totalTarefas:this.dados.tarefas.size,sistemaUnificado:this.config.sistemaUnificado,performanceMetrics:this.estadoSistema.performanceMetrics,cacheStats:{entradas:this.cache.size,maxSize:this.config.performance.maxCacheSize,hitRate:this._calculateCacheHitRate()}}}_calculateCacheHitRate(){return 0}ehAdmin(){try{return!("undefined"==typeof Auth||!Auth.ehAdmin)&&Auth.ehAdmin()}catch(e){return!1}}podeEditar(){return!this.estadoSistema.modoAnonimo}_buscarEvento(e){return this.dados.eventos.get(e)||null}async _carregarDados(){try{if(this.estadoSistema.firebaseDisponivel&&database)try{const e=(await database.ref("dados").once("value")).val();if(e)return void this._deserializarDados(e)}catch(e){}this._carregarDadosLocal()}catch(e){this._estruturaVazia()}}_carregarDadosLocal(){try{const e=localStorage.getItem("biapo_dados_v8_optimized");if(e){const t=JSON.parse(e);this._deserializarDados(t),this.estadoSistema.usandoLocalStorage=!0}else this._estruturaVazia()}catch(e){this._estruturaVazia()}}_estruturaVazia(){this.dados={areas:new Map,eventos:new Map,tarefas:new Map,usuarios:new Map,metadata:{versao:this.config.versao,ultimaAtualizacao:(new Date).toISOString(),totalItens:0,indices:new Map}}}async _salvarDadosLocal(e){try{const t=JSON.stringify(e);localStorage.setItem("biapo_dados_v8_optimized",t),localStorage.setItem("biapo_dados_timestamp_optimized",(new Date).toISOString()),this.estadoSistema.usandoLocalStorage=!0}catch(t){try{sessionStorage.setItem("biapo_dados_backup_optimized",JSON.stringify(e))}catch(e){}}}async _salvarFirebase(e){try{await database.ref("dados").set(e)}catch(e){throw this.estadoSistema.firebaseDisponivel=!1,e}}_salvarBackupEmergencia(){try{const e={dados:this._serializarDados(),timestamp:(new Date).toISOString(),versao:this.config.versao,tipo:"emergencia"};try{localStorage.setItem("biapo_backup_emergencia_optimized",JSON.stringify(e))}catch(t){sessionStorage.setItem("biapo_backup_emergencia_optimized",JSON.stringify(e))}}catch(e){}}_removeFromIndices(e,t){if("evento"===e){const e=this.indices.eventosPorData.get(t.data);if(e){const a=e.indexOf(t.id);a>-1&&e.splice(a,1)}(t.participantes||[]).forEach(e=>{const a=this.indices.eventosPorParticipante.get(e);if(a){const e=a.indexOf(t.id);e>-1&&a.splice(e,1)}})}else if("tarefa"===e){const e=this.indices.tarefasPorUsuario.get(t.responsavel);if(e){const a=e.indexOf(t.id);a>-1&&e.splice(a,1)}const a=this.indices.tarefasPorStatus.get(t.status);if(a){const e=a.indexOf(t.id);e>-1&&a.splice(e,1)}}}}const App=t.getInstance();"undefined"!=typeof window&&(window.App=App,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{App.init().catch(console.error)}):App.init().catch(console.error));var i=App;class o{constructor(){this.config={versao:"8.12.1-optimized",enabled:!0,autoReport:!0,reportInterval:3e4,maxMetricsHistory:100,thresholds:{slowOperation:1e3,memoryWarning:52428800,fpsWarning:30}},this.metrics={operations:new Map,memory:[],fps:[],loadTimes:new Map,errors:[],networkRequests:[],cacheStats:new Map,userInteractions:[]},this.observers={performance:null,memory:null,fps:null},this.startTime=performance.now(),this.isMonitoring=!1}init(){this.config.enabled&&(this._setupPerformanceObserver(),this._setupMemoryMonitoring(),this._setupFPSMonitoring(),this._setupNetworkMonitoring(),this._setupErrorTracking(),this._setupUserInteractionTracking(),this.config.autoReport&&this._startAutoReporting(),this.isMonitoring=!0)}_setupPerformanceObserver(){if("PerformanceObserver"in window){this.observers.performance=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this._processPerformanceEntry(e)})});try{this.observers.performance.observe({entryTypes:["measure","navigation","resource","paint","largest-contentful-paint"]})}catch(e){}}}_processPerformanceEntry(e){switch(e.entryType){case"measure":this._recordOperation(e.name,e.duration);break;case"navigation":this._recordLoadTime("navigation",e.duration);break;case"resource":this._recordNetworkRequest(e);break;case"paint":case"largest-contentful-paint":this._recordPaintMetric(e)}}_recordOperation(e,t){this.metrics.operations.has(e)||this.metrics.operations.set(e,[]);const a=this.metrics.operations.get(e);a.push({duration:t,timestamp:Date.now()}),a.length>this.config.maxMetricsHistory&&a.shift(),t>this.config.thresholds.slowOperation&&this._logSlowOperation(e,t)}_recordLoadTime(e,t){this.metrics.loadTimes.has(e)||this.metrics.loadTimes.set(e,[]);const a=this.metrics.loadTimes.get(e);a.push({duration:t,timestamp:Date.now()}),a.length>this.config.maxMetricsHistory&&a.shift()}_recordNetworkRequest(e){this.metrics.networkRequests.push({name:e.name,duration:e.duration,transferSize:e.transferSize,responseStart:e.responseStart,responseEnd:e.responseEnd,timestamp:Date.now()}),this.metrics.networkRequests.length>this.config.maxMetricsHistory&&this.metrics.networkRequests.shift()}_recordPaintMetric(e){}_setupMemoryMonitoring(){if(!("memory"in performance))return;const e=()=>{const e={used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit,timestamp:Date.now()};this.metrics.memory.push(e),this.metrics.memory.length>this.config.maxMetricsHistory&&this.metrics.memory.shift(),e.used>this.config.thresholds.memoryWarning&&this._logMemoryWarning(e)};e(),setInterval(e,5e3)}_setupFPSMonitoring(){let e=performance.now(),t=0;const a=()=>{const i=performance.now();if(t++,i-e>=1e3){const a=Math.round(1e3*t/(i-e));this.metrics.fps.push({fps:a,timestamp:Date.now()}),this.metrics.fps.length>this.config.maxMetricsHistory&&this.metrics.fps.shift(),a<this.config.thresholds.fpsWarning&&this._logFPSWarning(a),t=0,e=i}this.isMonitoring&&requestAnimationFrame(a)};requestAnimationFrame(a)}_setupNetworkMonitoring(){const e=window.fetch;window.fetch=async(...t)=>{const a=performance.now();try{const i=await e(...t),o=performance.now();return this._recordFetchMetric(t[0],o-a,i.status,"success"),i}catch(e){const i=performance.now();throw this._recordFetchMetric(t[0],i-a,0,"error"),e}}}_recordFetchMetric(e,t,a,i){this.metrics.networkRequests.push({url:"string"==typeof e?e:e.url,duration:t,status:a,result:i,timestamp:Date.now()})}_setupErrorTracking(){window.addEventListener("error",e=>{this._recordError({type:"javascript",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error?.stack,timestamp:Date.now()})}),window.addEventListener("unhandledrejection",e=>{this._recordError({type:"promise",message:e.reason?.message||String(e.reason),stack:e.reason?.stack,timestamp:Date.now()})})}_recordError(e){this.metrics.errors.push(e),this.metrics.errors.length>this.config.maxMetricsHistory&&this.metrics.errors.shift()}_setupUserInteractionTracking(){["click","keydown","scroll","resize"].forEach(e=>{document.addEventListener(e,()=>{this._recordUserInteraction(e)},{passive:!0})})}_recordUserInteraction(e){this.metrics.userInteractions.push({type:e,timestamp:Date.now()}),this.metrics.userInteractions.length>this.config.maxMetricsHistory&&this.metrics.userInteractions.shift()}_startAutoReporting(){setInterval(()=>{this._generateReport()},this.config.reportInterval)}_logSlowOperation(e,t){}_logMemoryWarning(e){(e.used/1048576).toFixed(2)}_logFPSWarning(e){}measure(e,t){const a=performance.now();try{const i=t();if(i&&"function"==typeof i.then)return i.finally(()=>{const t=performance.now();this._recordOperation(e,t-a)});{const t=performance.now();return this._recordOperation(e,t-a),i}}catch(t){const i=performance.now();throw this._recordOperation(e,i-a),t}}async measureAsync(e,t){const a=performance.now();try{const i=await t(),o=performance.now();return this._recordOperation(e,o-a),i}catch(t){const i=performance.now();throw this._recordOperation(e,i-a),t}}recordCacheMetric(e,t,a){this.metrics.cacheStats.has(e)||this.metrics.cacheStats.set(e,{hits:0,misses:0,operations:[]});const i=this.metrics.cacheStats.get(e);a?i.hits++:i.misses++,i.operations.push({operation:t,hit:a,timestamp:Date.now()}),i.operations.length>this.config.maxMetricsHistory&&i.operations.shift()}_calculateAverages(){const e={};return this.metrics.operations.forEach((t,a)=>{if(t.length>0){const i=t.reduce((e,t)=>e+t.duration,0);e[a]={avg:i/t.length,min:Math.min(...t.map(e=>e.duration)),max:Math.max(...t.map(e=>e.duration)),count:t.length}}}),e}_calculateMemoryStats(){if(0===this.metrics.memory.length)return null;const e=this.metrics.memory[this.metrics.memory.length-1],t=Math.max(...this.metrics.memory.map(e=>e.used));return{current:e.used,peak:t,limit:e.limit,utilization:(e.used/e.limit*100).toFixed(2)}}_calculateFPSStats(){if(0===this.metrics.fps.length)return null;const e=this.metrics.fps.map(e=>e.fps);return{current:e[e.length-1],avg:e.reduce((e,t)=>e+t,0)/e.length,min:Math.min(...e),max:Math.max(...e)}}_generateReport(){const e={timestamp:Date.now(),uptime:performance.now()-this.startTime,operations:this._calculateAverages(),memory:this._calculateMemoryStats(),fps:this._calculateFPSStats(),errors:this.metrics.errors.length,networkRequests:this.metrics.networkRequests.length,cacheStats:Object.fromEntries(Array.from(this.metrics.cacheStats.entries()).map(([e,t])=>[e,{hitRate:t.hits+t.misses>0?(t.hits/(t.hits+t.misses)*100).toFixed(2):0,totalOperations:t.hits+t.misses}]))};return this._dispatchReportEvent(e),e}_dispatchReportEvent(e){window.dispatchEvent(new CustomEvent("performance-report",{detail:e}))}getMetrics(){return{operations:Object.fromEntries(this.metrics.operations),memory:this.metrics.memory.slice(-10),fps:this.metrics.fps.slice(-10),errors:this.metrics.errors.slice(-10),networkRequests:this.metrics.networkRequests.slice(-10),cacheStats:Object.fromEntries(this.metrics.cacheStats)}}getReport(){return this._generateReport()}clear(){this.metrics.operations.clear(),this.metrics.memory=[],this.metrics.fps=[],this.metrics.errors=[],this.metrics.networkRequests=[],this.metrics.cacheStats.clear(),this.metrics.userInteractions=[]}stop(){this.isMonitoring=!1,this.observers.performance&&this.observers.performance.disconnect()}}const s=new o;"undefined"!=typeof window&&(s.init(),window.PerformanceMonitor=s,window.measurePerformance=(e,t)=>s.measure(e,t),window.getPerformanceReport=()=>s.getReport());a(3),a(968),a(159),a(557);const n=new class{constructor(){this.modules=new Map,this.loadedModules=new Set,this.initPromises=new Map,this.performanceMetrics={bundleLoadTime:0,moduleLoadTimes:new Map,totalModules:0,failedModules:[]}}async init(){const e=performance.now();try{performance.mark("bundle-init-start"),await this.initCore(),await this.initCriticalModules(),this.setupLazyLoading(),this.setupGlobalErrorHandling(),performance.mark("bundle-init-end"),performance.measure("bundle-init","bundle-init-start","bundle-init-end");const t=performance.now();this.performanceMetrics.bundleLoadTime=t-e,this.dispatchReadyEvent()}catch(e){this.handleBundleError(e)}}async initCore(){try{performance.mark("core-init-start"),await i.init(),this.modules.set("App",i),this.loadedModules.add("App"),performance.mark("core-init-end"),performance.measure("core-init","core-init-start","core-init-end")}catch(e){throw e}}async initCriticalModules(){const e=[{name:"Auth",init:()=>this.loadAuth()},{name:"Notifications",init:()=>this.loadNotifications()}].map(async e=>{try{performance.mark(`${e.name}-init-start`),await e.init(),this.loadedModules.add(e.name),performance.mark(`${e.name}-init-end`),performance.measure(`${e.name}-init`,`${e.name}-init-start`,`${e.name}-init-end`)}catch(t){this.performanceMetrics.failedModules.push(e.name)}});await Promise.allSettled(e)}setupLazyLoading(){const e={Events:()=>this.loadEvents(),Calendar:()=>this.loadCalendar(),AdminUsersManager:()=>this.loadAdminUsersManager()};Object.entries(e).forEach(([e,t])=>{Object.defineProperty(window,e,{get:()=>(this.loadedModules.has(e)||this.loadModule(e,t),this.modules.get(e)),configurable:!0})})}async loadModule(e,t){if(this.initPromises.has(e))return this.initPromises.get(e);const a=this.performModuleLoad(e,t);return this.initPromises.set(e,a),a}async performModuleLoad(e,t){try{performance.mark(`${e}-load-start`);const a=await t();this.modules.set(e,a),this.loadedModules.add(e),performance.mark(`${e}-load-end`),performance.measure(`${e}-load`,`${e}-load-start`,`${e}-load-end`);const i=performance.getEntriesByName(`${e}-load`);return i.length>0&&this.performanceMetrics.moduleLoadTimes.set(e,i[0].duration),a}catch(t){throw this.performanceMetrics.failedModules.push(e),t}}async loadAuth(){try{const{OptimizedAuth:e}=await Promise.resolve().then(a.bind(a,3)),t=new e;return await t.init(),window.Auth=t,this.modules.set("Auth",t),t}catch(e){const t={login:()=>{},logout:()=>{},estaLogado:()=>!1};return window.Auth=t,this.modules.set("Auth",t),t}}async loadNotifications(){try{const{OptimizedNotifications:e}=await Promise.resolve().then(a.bind(a,557)),t=new e;return window.Notifications=t,this.modules.set("Notifications",t),t}catch(e){const t={success:e=>{},error:e=>{},warning:e=>{},info:e=>{}};return window.Notifications=t,this.modules.set("Notifications",t),t}}async loadEvents(){try{const{OptimizedEvents:e}=await Promise.resolve().then(a.bind(a,968)),t=new e;return window.Events=t,this.modules.set("Events",t),t}catch(e){throw e}}async loadCalendar(){try{const{OptimizedCalendar:e}=await Promise.resolve().then(a.bind(a,159)),t=new e;return window.Calendar=t,this.modules.set("Calendar",t),t}catch(e){throw e}}async loadAdminUsersManager(){try{const{OptimizedAdminUsersManager:e}=await Promise.resolve().then(function(){var e=new Error("Cannot find module './modules/admin-users-manager-optimized.js'");throw e.code="MODULE_NOT_FOUND",e}),t=new e;return window.AdminUsersManager=t,this.modules.set("AdminUsersManager",t),t}catch(e){throw e}}setupGlobalErrorHandling(){window.addEventListener("error",e=>{this.handleGlobalError(e.error)}),window.addEventListener("unhandledrejection",e=>{this.handleGlobalError(e.reason)})}handleGlobalError(e){if(this.modules.has("Notifications")){this.modules.get("Notifications").error("Erro interno do sistema")}this.reportError(e)}handleBundleError(e){document.body.innerHTML='\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        background: #fee2e2;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-family: system-ui;\n        z-index: 999999;\n      ">\n        <div style="\n          background: white;\n          padding: 40px;\n          border-radius: 12px;\n          box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n          text-align: center;\n          max-width: 500px;\n        ">\n          <h1 style="color: #dc2626; margin: 0 0 20px 0;">‚ö†Ô∏è Erro de Sistema</h1>\n          <p style="color: #374151; margin-bottom: 20px;">\n            Houve um problema ao carregar o Sistema BIAPO. \n            Tente recarregar a p√°gina.\n          </p>\n          <button onclick="window.location.reload()" style="\n            background: #dc2626;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 16px;\n          ">üîÑ Recarregar P√°gina</button>\n        </div>\n      </div>\n    '}reportError(e){if("object"==typeof e&&null!==e){const t={message:e.message,stack:e.stack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,loadedModules:Array.from(this.loadedModules),failedModules:this.performanceMetrics.failedModules};localStorage.setItem("biapo_last_error",JSON.stringify(t))}}dispatchReadyEvent(){const e=new CustomEvent("biapo-system-ready",{detail:{modules:Array.from(this.loadedModules),performanceMetrics:this.performanceMetrics,timestamp:Date.now()}});document.dispatchEvent(e)}getStatus(){return{loadedModules:Array.from(this.loadedModules),failedModules:this.performanceMetrics.failedModules,bundleLoadTime:this.performanceMetrics.bundleLoadTime,moduleLoadTimes:Object.fromEntries(this.performanceMetrics.moduleLoadTimes),totalModules:this.modules.size}}async preloadModule(e){if(this.loadedModules.has(e))return this.modules.get(e);const t={Events:()=>this.loadEvents(),Calendar:()=>this.loadCalendar(),AdminUsersManager:()=>this.loadAdminUsersManager()};if(t[e])return this.loadModule(e,t[e]);throw new Error(`M√≥dulo ${e} n√£o encontrado`)}async warmupModules(){const e=["Events","Calendar"].map(e=>this.preloadModule(e).catch(e=>{}));await Promise.allSettled(e)}};document.addEventListener("DOMContentLoaded",()=>{n.init().catch(e=>{})}),setTimeout(()=>{n.warmupModules().catch(e=>{})},2e3),window.SystemBundle=n,window.preloadModule=e=>n.preloadModule(e),window.getBundleStatus=()=>n.getStatus()}()}();