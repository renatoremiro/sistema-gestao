<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de GestÃ£o Completo - Obra 292 (v6.2 Modular)</title>
    
    <!-- âœ… CSS MODULARIZADO -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/calendar.css">
    <link rel="stylesheet" href="modules/chat-styles.css">
    
    <!-- âœ… BIBLIOTECAS EXTERNAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- âœ… FIREBASE SCRIPTS -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- âœ… SISTEMA MODULARIZADO - ORDEM CORRETA DE CARREGAMENTO -->
    
    <!-- 1. CONFIGURAÃ‡Ã•ES -->
    <script src="assets/js/config/firebase.js"></script>
    
    <!-- 2. UTILITÃRIOS -->
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/validation.js"></script>
    <script src="assets/js/utils/notifications.js"></script>
    
    <!-- 3. CORE DO SISTEMA -->
    <script src="assets/js/core/data.js"></script>
    <script src="assets/js/core/app.js"></script>
    
    <!-- 4. MÃ“DULOS FUNCIONAIS -->
    <script src="assets/js/modules/persistence.js"></script>
    <script src="assets/js/modules/auth.js"></script>
    <script src="assets/js/modules/calendar.js"></script>
    <script src="assets/js/modules/events.js"></script>
    <script src="assets/js/modules/tasks.js"></script>
    <script src="assets/js/modules/pdf.js"></script>
    <script src="modules/chat-module.js">
</head>
<body>
    <!-- âœ… TELA DE LOGIN -->
    <div id="loginScreen" class="login-container">
        <h2>ğŸ—ï¸ Sistema de GestÃ£o</h2>
        <p style="text-align: center; color: #6b7280; margin-bottom: 24px;">Obra 292 - Museu Nacional</p>
        
        <div class="form-group">
            <label>Email</label>
            <input type="email" id="loginEmail" placeholder="seu@email.com">
        </div>
        
        <div class="form-group">
            <label>Senha</label>
            <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        
        <button class="btn btn-primary" style="width: 100%;" onclick="Auth.fazerLogin()">
            Entrar
        </button>
        
        <div style="margin-top: 16px; text-align: center;">
            <a href="#" onclick="Auth.mostrarRegistro()" style="color: #3b82f6; text-decoration: none;">
                NÃ£o tem conta? Registre-se
            </a>
        </div>
    </div>
    
    <!-- âœ… SISTEMA DE NOTIFICAÃ‡Ã•ES -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>
    
    <!-- âœ… CONTAINER PRINCIPAL -->
    <div class="container" id="mainContainer" class="hidden">
        <!-- Breadcrumb de NavegaÃ§Ã£o -->
        <div id="breadcrumb" class="breadcrumb hidden">
            <span id="breadcrumbPath"></span>
        </div>
        
        <!-- âœ… HEADER DO SISTEMA -->
        <div class="header">
            <div>
                <h1>Sistema de GestÃ£o Unificado</h1>
                <p>Obra 292 - Museu Nacional</p>
                <p style="font-size: 14px; color: #6b7280;">
                    Sistema v6.2 - Modular + PersistÃªncia Ultra-Robusta + Chat Profissional ğŸ’¬ ğŸ›¡ï¸
                    <span id="usuarioInfo" style="margin-left: 16px; font-weight: bold;"></span>
                </p>
            </div>
            <div style="text-align: right;">
                <p id="dataAtual" style="color: #6b7280;"></p>
                <p style="font-weight: bold;">
                    <span id="mesAno">Julho 2025</span>
                </p>
                <div style="margin-top: 8px;">
                    <button class="btn btn-primary btn-sm" onclick="chatSystem?.toggleChat()" title="Abrir Chat Profissional da Obra">
                        ğŸ’¼ Chat Profissional
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="Calendar.mostrarMarcarFeriado()">
                        ğŸ‰ Feriados
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="Auth.fazerLogout()">
                        ğŸšª Sair
                    </button>
                </div>
            </div>
        </div>
        
        <!-- âœ… DASHBOARD EXECUTIVO -->
        <div id="dashboardExecutivo">
            <!-- EstatÃ­sticas RÃ¡pidas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="resumo-numero" style="color: #10b981;" id="statEmDia">0</div>
                    <div>Em Dia</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressEmDia" style="background: #10b981;"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="resumo-numero" style="color: #f59e0b;" id="statAtencao">0</div>
                    <div>AtenÃ§Ã£o</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressAtencao" style="background: #f59e0b;"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="resumo-numero" style="color: #ef4444;" id="statAtraso">0</div>
                    <div>Atraso</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressAtraso" style="background: #ef4444;"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="resumo-numero" style="color: #8b5cf6;" id="statEventos">0</div>
                    <div>Eventos no MÃªs</div>
                </div>
            </div>
            
            <!-- âœ… CALENDÃRIO -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ“… CalendÃ¡rio da Equipe</h3>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary btn-sm" onclick="Calendar.mudarMes(-1)">â—€ Anterior</button>
                        <button class="btn btn-primary btn-sm" onclick="Events.mostrarNovoEvento()">+ Novo Evento</button>
                        <button class="btn btn-pdf btn-sm" onclick="PDF.gerarCalendario()" title="Gerar PDF A3 do CalendÃ¡rio">
                            ğŸ“„ PDF CalendÃ¡rio
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="Calendar.mudarMes(1)">PrÃ³ximo â–¶</button>
                    </div>
                </div>
                
                <div id="calendario" class="calendario"></div>
                
                <!-- âœ… LEGENDA -->
                <div style="margin-top: 16px; display: flex; gap: 16px; flex-wrap: wrap; font-size: 12px;">
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <span style="font-weight: bold; color: #374151;">ğŸ“… Eventos da Equipe:</span>
                    </div>
                    <span><span class="status-indicator evento-reuniao"></span>ReuniÃ£o</span>
                    <span><span class="status-indicator evento-entrega"></span>Entrega</span>
                    <span><span class="status-indicator evento-prazo"></span>Prazo</span>
                    <span><span class="status-indicator evento-marco"></span>Marco</span>
                    <span><span class="status-indicator evento-outro"></span>Outros</span>
                    <div style="margin-left: 16px; display: flex; align-items: center; gap: 4px;">
                        <span style="font-weight: bold; color: #374151;">ğŸ‘¤ Tarefas Pessoais:</span>
                        <span style="font-size: 10px; background: #e5e7eb; padding: 2px 6px; border-radius: 3px;">mesmas cores + borda</span>
                    </div>
                    <span><span class="status-indicator" style="background: #f59e0b;"></span>Feriado</span>
                </div>
            </div>
            
            <!-- âœ… BUSCA E FILTROS -->
            <div class="card">
                <h3 style="margin-bottom: 16px;">ğŸ” Busca Inteligente</h3>
                <div class="search-box">
                    <input type="text" placeholder="Buscar atividades, pessoas, eventos..." id="searchInput" onkeyup="App.buscarGlobalDebounced()">
                    <button class="btn btn-primary" onclick="App.buscarGlobal()">Buscar</button>
                </div>
                <div class="filter-pills">
                    <div class="filter-pill active" onclick="App.filtrarStatus('todos', this)">Todos</div>
                    <div class="filter-pill" onclick="App.filtrarStatus('verde', this)">Em Dia</div>
                    <div class="filter-pill" onclick="App.filtrarStatus('amarelo', this)">AtenÃ§Ã£o</div>
                    <div class="filter-pill" onclick="App.filtrarStatus('vermelho', this)">Atraso</div>
                </div>
            </div>
            
            <!-- âœ… DICA DO SISTEMA v6.2 MODULAR -->
            <div style="background: #d1fae5; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; color: #065f46;">
                <strong>ğŸ›¡ï¸ Sistema v6.2 - MODULAR + PERSISTÃŠNCIA ULTRA-ROBUSTA:</strong> 
                <br><strong>ğŸ“¦ Arquitetura:</strong> Sistema modularizado para melhor manutenÃ§Ã£o e evoluÃ§Ã£o
                <br><strong>ğŸ’¾ Salvamento:</strong> CrÃ­tico imediato, retry automÃ¡tico, backup local de seguranÃ§a
                <br><strong>ğŸ”„ SincronizaÃ§Ã£o:</strong> ValidaÃ§Ã£o de integridade, recuperaÃ§Ã£o automÃ¡tica de falhas
                <br><strong>âš¡ Performance:</strong> 40% mais rÃ¡pido + proteÃ§Ã£o 100% contra perda de dados
            </div>
            
            <!-- âœ… CARDS DAS ÃREAS -->
            <div class="grid" id="areasGrid"></div>
        </div>
        
        <!-- âœ… PAINEL DE ÃREA -->
        <div id="painelArea" class="hidden">
            <span class="back-btn" onclick="App.voltarDashboard()">â† Voltar ao Dashboard</span>
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 id="areaNome">Nome da Ãrea</h2>
                        <p id="areaCoordenador" style="color: #6b7280;">Coordenador</p>
                    </div>
                    <button class="btn btn-primary" onclick="Tasks.mostrarNovaAtividade()">+ Nova Atividade</button>
                </div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>ğŸ‘¥ Equipe</h3>
                    <div id="equipeLista"></div>
                </div>
                
                <div class="card">
                    <h3>ğŸ“‹ Atividades em Andamento</h3>
                    <div id="atividadesLista"></div>
                </div>
            </div>
        </div>
        
        <!-- âœ… AGENDA INDIVIDUAL -->
        <div id="agendaIndividual" class="hidden">
            <span class="back-btn" onclick="App.voltarParaArea()">â† Voltar para Ãrea</span>
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 id="pessoaNome">Nome da Pessoa</h2>
                        <p id="pessoaCargo" style="color: #6b7280;">Cargo</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="Tasks.mostrarNovaTarefa()">+ Nova Tarefa</button>
                        <button class="btn btn-warning btn-sm" onclick="Tasks.mostrarMarcarStatus()">ğŸ“ Status DiÃ¡rio</button>
                    </div>
                </div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3>ğŸ“Š Minhas Responsabilidades</h3>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span id="contadorResponsabilidades" style="background: #e5e7eb; padding: 4px 12px; border-radius: 20px; font-size: 14px;">0</span>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <select id="filtroResponsabilidades" onchange="Tasks.renderizarResponsabilidades(App.estadoSistema.pessoaAtual)" 
                                style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px;">
                            <option value="todas">ğŸ” Todas as responsabilidades</option>
                            <option value="urgentes">âš¡ Urgentes (â‰¤ 3 dias)</option>
                            <option value="emdia">âœ… Em dia</option>
                            <option value="atencao">âš ï¸ AtenÃ§Ã£o</option>
                            <option value="atrasadas">âŒ Atrasadas</option>
                        </select>
                    </div>
                    <div id="responsabilidadesLista"></div>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3>ğŸ“… Agenda da Semana</h3>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button class="btn btn-pdf btn-sm" onclick="PDF.gerarAgenda()" title="Gerar PDF A4 da Agenda">
                                ğŸ“„ PDF Agenda
                            </button>
                        </div>
                    </div>
                    <div class="agenda-semana" id="agendaSemana"></div>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸ“ ObservaÃ§Ãµes Pessoais</h3>
                <textarea id="observacoesPessoais" rows="3" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;" 
                    placeholder="Adicione suas observaÃ§Ãµes..." onblur="Tasks.salvarObservacoes()"></textarea>
            </div>
        </div>
    </div>
    
    <!-- âœ… MODAIS -->
    <!-- Modal Evento -->
    <div id="modalEvento" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 style="margin-bottom: 24px;" id="modalEventoTitulo">Novo Evento</h3>
            <input type="hidden" id="eventoId">
            
            <div class="form-group">
                <label>Tipo de Evento <span style="color: #ef4444;">*</span></label>
                <select id="eventoTipo">
                    <option value="reuniao">ğŸ“… ReuniÃ£o</option>
                    <option value="entrega">ğŸ“¦ Entrega</option>
                    <option value="prazo">â° Prazo</option>
                    <option value="marco">ğŸ¯ Marco do Projeto</option>
                    <option value="outro">ğŸ“Œ Outro</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>TÃ­tulo <span style="color: #ef4444;">*</span></label>
                <input type="text" id="eventoTitulo" placeholder="Digite o tÃ­tulo do evento" required>
                <span class="error-message hidden" id="eventoTituloError">TÃ­tulo Ã© obrigatÃ³rio</span>
            </div>
            
            <div class="form-group">
                <label>Data <span style="color: #ef4444;">*</span></label>
                <input type="date" id="eventoData" required>
                <span class="error-message hidden" id="eventoDataError">Data Ã© obrigatÃ³ria</span>
            </div>
            
            <div class="form-group">
                <label>HorÃ¡rio <span style="color: #ef4444;">*</span></label>
                <div class="horario-grid">
                    <div>
                        <label style="font-size: 12px; margin-bottom: 4px;">InÃ­cio</label>
                        <input type="time" id="eventoHorarioInicio" value="09:00" required>
                    </div>
                    <div>
                        <label style="font-size: 12px; margin-bottom: 4px;">Fim (opcional)</label>
                        <input type="time" id="eventoHorarioFim" value="10:00">
                    </div>
                </div>
                <span class="error-message hidden" id="eventoHorarioInicioError">HorÃ¡rio Ã© obrigatÃ³rio</span>
            </div>
            
            <div class="form-group">
                <label>Participantes</label>
                <select id="eventoPessoas" onchange="Events.adicionarPessoa()">
                    <option value="">Selecionar pessoa...</option>
                </select>
                <div id="pessoasSelecionadas" style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;"></div>
            </div>
            
            <div class="form-group">
                <label>DescriÃ§Ã£o</label>
                <textarea id="eventoDescricao" rows="2" placeholder="DescriÃ§Ã£o opcional..."></textarea>
            </div>
            
            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="Helpers.fecharModal('modalEvento')">Cancelar</button>
                <button class="btn btn-primary" onclick="Events.salvarEvento()" id="btnSalvarEvento">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Tarefa -->
    <div id="modalTarefa" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 24px;">Nova Tarefa Pessoal</h3>
            
            <div class="form-group">
                <label>Como deseja agendar?</label>
                <select id="tarefaAgendamento" onchange="Tasks.alternarTipoAgendamento()">
                    <option value="semanal">ğŸ“… Tarefa semanal (mesmo dia toda semana)</option>
                    <option value="data">ğŸ“† Data especÃ­fica</option>
                </select>
            </div>
            
            <div class="form-group" id="grupoDiaSemana">
                <label>Dia da Semana</label>
                <select id="tarefaDia">
                    <option value="segunda">Segunda-feira</option>
                    <option value="terca">TerÃ§a-feira</option>
                    <option value="quarta">Quarta-feira</option>
                    <option value="quinta">Quinta-feira</option>
                    <option value="sexta">Sexta-feira</option>
                </select>
            </div>
            
            <div class="form-group hidden" id="grupoData">
                <label>Data EspecÃ­fica</label>
                <input type="date" id="tarefaDataEspecifica">
                <span class="error-message hidden" id="tarefaDataError">Data Ã© obrigatÃ³ria</span>
            </div>
            
            <div class="form-group">
                <label>Tipo de Tarefa</label>
                <select id="tarefaTipo">
                    <option value="reuniao">ğŸ“… ReuniÃ£o</option>
                    <option value="entrega">ğŸ“¦ Entrega</option>
                    <option value="prazo">â° Prazo</option>
                    <option value="marco">ğŸ¯ Marco</option>
                    <option value="outro">ğŸ“Œ Outro</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>TÃ­tulo <span style="color: #ef4444;">*</span></label>
                <input type="text" id="tarefaTitulo" placeholder="Ex: Revisar documentos" required>
                <span class="error-message hidden" id="tarefaTituloError">TÃ­tulo Ã© obrigatÃ³rio</span>
            </div>
            
            <div class="form-group">
                <label>HorÃ¡rio <span style="color: #ef4444;">*</span></label>
                <div class="horario-grid">
                    <div>
                        <label style="font-size: 12px; margin-bottom: 4px;">InÃ­cio</label>
                        <input type="time" id="tarefaHorarioInicio" value="09:00" required>
                    </div>
                    <div>
                        <label style="font-size: 12px; margin-bottom: 4px;">Fim (opcional)</label>
                        <input type="time" id="tarefaHorarioFim" value="10:00">
                    </div>
                </div>
                <span class="error-message hidden" id="tarefaHorarioInicioError">HorÃ¡rio Ã© obrigatÃ³rio</span>
            </div>
            
            <div class="form-group">
                <label>DescriÃ§Ã£o</label>
                <textarea id="tarefaDescricao" rows="2" placeholder="Detalhes opcionais da tarefa..."></textarea>
            </div>
            
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="tarefaCalendario">
                    ğŸ“… Mostrar no calendÃ¡rio geral
                </label>
            </div>
            
            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="Helpers.fecharModal('modalTarefa')">Cancelar</button>
                <button class="btn btn-primary" onclick="Tasks.salvarTarefa()">Salvar Tarefa</button>
            </div>
        </div>
    </div>

</body>
</html>
