<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Agenda - Sistema BIAPO</title>
    
    <!-- ‚úÖ CSS DO SISTEMA -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/calendar.css">
    
    <!-- ‚úÖ FIREBASE SCRIPTS -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- ‚úÖ SISTEMA MODULARIZADO -->
    <script src="assets/js/config/firebase.js"></script>
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/validation.js"></script>
    <script src="assets/js/utils/notifications.js"></script>
    <script src="assets/js/core/data.js"></script>
    <script src="assets/js/core/app.js"></script>
    <script src="assets/js/modules/persistence.js"></script>
    <script src="assets/js/modules/auth.js"></script>
    <script src="assets/js/modules/tasks.js"></script>
    <script src="assets/js/modules/personal-agenda.js"></script>
    <script src="assets/js/modules/personal-tasks.js"></script>
    
    <style>
        /* üî¥ CORES BIAPO */
        :root {
            --biapo-red: #C53030;
            --biapo-red-light: #E53E3E;
            --biapo-red-dark: #9B2C2C;
            --biapo-orange: #DD6B20;
            --biapo-gray: #2D3748;
            --biapo-gray-light: #4A5568;
            --biapo-gray-lighter: #718096;
            --accent-green: #38A169;
            --accent-yellow: #D69E2E;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        .page-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* üî¥ HEADER DA P√ÅGINA */
        .page-header {
            background: linear-gradient(135deg, var(--biapo-red) 0%, var(--biapo-red-dark) 100%);
            color: white;
            padding: 24px 32px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(197, 48, 48, 0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-biapo {
            height: 60px;
            width: auto;
            background: white;
            padding: 8px;
            border-radius: 8px;
        }

        .header-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info-badge {
            background: rgba(255,255,255,0.1);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
        }

        .user-email {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn-header {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-header:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        /* üéõÔ∏è CONTROLES PRINCIPAIS */
        .main-controls {
            background: white;
            padding: 24px 32px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .view-tabs {
            display: flex;
            gap: 4px;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 8px;
        }

        .view-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--biapo-gray);
        }

        .view-tab.active {
            background: var(--biapo-red);
            color: white;
            box-shadow: 0 2px 4px rgba(197, 48, 48, 0.3);
        }

        .filters-section {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--biapo-gray-lighter);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: var(--biapo-gray);
            min-width: 140px;
        }

        .actions-section {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--biapo-red) 0%, var(--biapo-red-light) 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--biapo-red-dark) 0%, var(--biapo-red) 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(197, 48, 48, 0.3);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--biapo-gray);
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-info {
            background: #06b6d4;
            color: white;
        }

        /* üìÖ GRID SEMANAL PRINCIPAL */
        .agenda-views {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .weekly-navigation {
            background: #f8fafc;
            padding: 20px 32px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .nav-btn {
            background: white;
            border: 1px solid #e2e8f0;
            color: var(--biapo-gray);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-btn:hover {
            border-color: var(--biapo-red);
            color: var(--biapo-red);
        }

        .current-week {
            font-size: 18px;
            font-weight: 700;
            color: var(--biapo-gray);
        }

        .weekly-grid {
            display: grid;
            grid-template-columns: 120px repeat(7, 1fr);
            min-height: 600px;
            background: white;
        }

        /* üìã CABE√áALHO DOS DIAS */
        .time-column {
            background: #f8fafc;
            border-right: 2px solid #e2e8f0;
            padding: 16px 8px;
            text-align: center;
            font-weight: 600;
            color: var(--biapo-gray);
        }

        .day-header {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            padding: 16px 8px;
            text-align: center;
            border-right: 1px solid #e2e8f0;
            border-bottom: 2px solid var(--biapo-red);
        }

        .day-header.today {
            background: linear-gradient(135deg, var(--biapo-red-light) 0%, var(--biapo-red) 100%);
            color: white;
        }

        .day-name {
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .day-date {
            font-size: 20px;
            font-weight: 700;
            margin-top: 4px;
        }

        .day-tasks-count {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* üìã COLUNA DE HOR√ÅRIOS */
        .time-slots {
            background: #f8fafc;
            border-right: 2px solid #e2e8f0;
            display: flex;
            flex-direction: column;
        }

        .time-slot {
            height: 60px;
            padding: 8px 4px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--biapo-gray-lighter);
        }

        /* üìù COLUNAS DOS DIAS */
        .day-column {
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            min-height: 100%;
            position: relative;
        }

        .day-column:last-child {
            border-right: none;
        }

        /* üïê SLOTS DE HOR√ÅRIO NOS DIAS */
        .hour-slot {
            height: 60px;
            border-bottom: 1px solid #f1f5f9;
            position: relative;
            padding: 4px;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .hour-slot:hover {
            background-color: rgba(197, 48, 48, 0.05);
        }

        /* üìã TAREFAS NO GRID */
        .task-item {
            background: white;
            border-radius: 6px;
            padding: 8px 10px;
            margin: 2px 0;
            border-left: 4px solid var(--biapo-red);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 11px;
        }

        .task-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .task-item.pessoal {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        .task-item.equipe {
            border-left-color: #06b6d4;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        .task-item.projeto {
            border-left-color: #8b5cf6;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        }

        .task-item.urgente {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            animation: pulse 2s infinite;
        }

        .task-item.rotina {
            border-left-color: #6b7280;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .task-time {
            font-size: 10px;
            font-weight: 600;
            color: var(--biapo-gray);
            margin-bottom: 2px;
        }

        .task-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--biapo-gray);
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .task-description {
            font-size: 10px;
            color: var(--biapo-gray-lighter);
            line-height: 1.3;
            margin-bottom: 4px;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
        }

        .task-priority {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-priority.baixa {
            background: #d1fae5;
            color: #065f46;
        }

        .task-priority.media {
            background: #fef3c7;
            color: #92400e;
        }

        .task-priority.alta {
            background: #fecaca;
            color: #991b1b;
        }

        .task-priority.critica {
            background: #dc2626;
            color: white;
        }

        .task-status {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        .task-status.pendente {
            background: #f3f4f6;
            color: #4b5563;
        }

        .task-status.andamento {
            background: #dbeafe;
            color: #1e40af;
        }

        .task-status.concluida {
            background: #d1fae5;
            color: #065f46;
        }

        .task-indicators {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .task-indicator {
            font-size: 12px;
        }

        /* üîÑ LINHA DO TEMPO ATUAL */
        .current-time-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--biapo-red);
            z-index: 10;
            box-shadow: 0 0 4px rgba(197, 48, 48, 0.5);
        }

        .current-time-line::before {
            content: '';
            position: absolute;
            left: -6px;
            top: -4px;
            width: 10px;
            height: 10px;
            background: var(--biapo-red);
            border-radius: 50%;
        }

        /* üìä ESTAT√çSTICAS */
        .stats-bar {
            background: #f8fafc;
            padding: 20px 32px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--biapo-red);
        }

        .stat-label {
            font-size: 12px;
            color: var(--biapo-gray-lighter);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* üîî NOTIFICA√á√ïES */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: none;
        }

        /* üî¥ MODAL SISTEMA */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 20000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            display: flex !important;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--biapo-red) 0%, var(--biapo-red-dark) 100%);
            color: white;
            padding: 20px 24px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.3);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e2e8f0;
            background: #f8fafc;
            border-radius: 0 0 16px 16px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* üìù FORMUL√ÅRIOS */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--biapo-gray);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--biapo-red);
            box-shadow: 0 0 0 3px rgba(197, 48, 48, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .form-checkbox input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        /* üè∑Ô∏è TAGS PARTICIPANTES */
        .participantes-container {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            min-height: 44px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .participantes-container:focus-within {
            border-color: var(--biapo-red);
            box-shadow: 0 0 0 3px rgba(197, 48, 48, 0.1);
        }

        .participante-tag {
            background: var(--biapo-red);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .participante-tag .remove {
            cursor: pointer;
            font-weight: bold;
        }

        .participante-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 120px;
            font-size: 14px;
        }

        /* üìã SUBTAREFAS */
        .subtarefas-list {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .subtarefa-item {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subtarefa-item:last-child {
            border-bottom: none;
        }

        .subtarefa-checkbox {
            width: 18px;
            height: 18px;
        }

        .subtarefa-texto {
            flex: 1;
            font-size: 14px;
        }

        .subtarefa-texto.concluida {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .subtarefa-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .btn-icon:hover {
            background: #f1f5f9;
        }

        /* üé® LOADING */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #f1f5f9;
            border-top: 3px solid var(--biapo-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* üì± RESPONSIVIDADE */
        @media (max-width: 1200px) {
            .weekly-grid {
                grid-template-columns: 100px repeat(7, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-container {
                padding: 12px;
            }
            
            .page-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
                padding: 20px;
            }
            
            .main-controls {
                flex-direction: column;
                align-items: stretch;
                padding: 20px;
            }
            
            .filters-section,
            .actions-section {
                justify-content: center;
            }
            
            .weekly-grid {
                grid-template-columns: 80px repeat(7, 1fr);
                font-size: 12px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* üéØ ESTADOS ESPECIAIS */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--biapo-gray-lighter);
            grid-column: 1 / -1;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--biapo-gray);
        }

        .empty-description {
            margin-bottom: 24px;
        }

        /* üé® ANIMA√á√ïES */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- üîî NOTIFICA√á√ïES -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <div class="page-container">
        <!-- üî¥ HEADER DA P√ÅGINA -->
        <div class="page-header">
            <div class="header-left">
                <img src="assets/img/Logo-biapo.jpg" alt="Logo BIAPO" class="logo-biapo">
                <div>
                    <h1 class="header-title">üìÖ Minha Agenda Pessoal</h1>
                    <p class="header-subtitle">Sistema de Gest√£o BIAPO - Obra 292</p>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info-badge">
                    <div class="user-name" id="userName">Carregando...</div>
                    <div class="user-email" id="userEmail">Verificando usu√°rio...</div>
                </div>
                <div class="header-actions">
                    <button class="btn-header" onclick="sincronizarDados()">
                        üîÑ Sincronizar
                    </button>
                    <button class="btn-header" onclick="voltarParaSistema()">
                        üè† Voltar ao Sistema
                    </button>
                </div>
            </div>
        </div>

        <!-- üéõÔ∏è CONTROLES PRINCIPAIS -->
        <div class="main-controls">
            <div class="view-tabs">
                <button class="view-tab active" onclick="alternarVisualizacao('grid')" data-view="grid">
                    üóìÔ∏è Grid Semanal
                </button>
                <button class="view-tab" onclick="alternarVisualizacao('list')" data-view="list">
                    üìã Lista de Tarefas
                </button>
            </div>

            <div class="filters-section">
                <div class="filter-group">
                    <label class="filter-label">Tipo</label>
                    <select class="filter-select" id="filtroTipo" onchange="aplicarFiltros()">
                        <option value="todos">üîÑ Todos os tipos</option>
                        <option value="urgente">üö® Urgente</option>
                        <option value="projeto">üèóÔ∏è Projeto</option>
                        <option value="equipe">üë• Equipe</option>
                        <option value="pessoal">üë§ Pessoal</option>
                        <option value="rotina">üîÑ Rotina</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="filter-select" id="filtroStatus" onchange="aplicarFiltros()">
                        <option value="todos">‚ö° Todos os status</option>
                        <option value="pendente">‚è≥ Pendente</option>
                        <option value="andamento">üî• Em andamento</option>
                        <option value="concluida">‚úÖ Conclu√≠da</option>
                        <option value="cancelada">‚ùå Cancelada</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Prioridade</label>
                    <select class="filter-select" id="filtroPrioridade" onchange="aplicarFiltros()">
                        <option value="todos">üéØ Todas as prioridades</option>
                        <option value="critica">üî¥ Cr√≠tica</option>
                        <option value="alta">üü† Alta</option>
                        <option value="media">üü° M√©dia</option>
                        <option value="baixa">üü¢ Baixa</option>
                    </select>
                </div>
            </div>

            <div class="actions-section">
                <button class="btn btn-secondary" onclick="exportarAgenda()">
                    üìÑ Exportar PDF
                </button>
                <button class="btn btn-info" onclick="mostrarRelatorios()">
                    üìä Relat√≥rios
                </button>
                <button class="btn btn-success" onclick="mostrarModalNovaTarefa()">
                    ‚ûï Nova Tarefa
                </button>
                <button class="btn btn-primary" onclick="sincronizarTudo()">
                    üîÑ Sincronizar Tudo
                </button>
            </div>
        </div>

        <!-- üìÖ GRID SEMANAL PRINCIPAL -->
        <div class="agenda-views">
            <!-- üóìÔ∏è GRID SEMANAL -->
            <div class="weekly-grid-view active" id="gridView">
                <div class="weekly-navigation">
                    <button class="nav-btn" onclick="navegarSemana(-1)">‚Üê Semana Anterior</button>
                    <span class="current-week" id="currentWeekDisplay">Carregando...</span>
                    <button class="nav-btn" onclick="navegarSemana(1)">Pr√≥xima Semana ‚Üí</button>
                    <button class="nav-btn" onclick="irParaHoje()">üè† Hoje</button>
                </div>

                <div class="weekly-grid" id="weeklyGrid">
                    <!-- GRID SER√Å RENDERIZADO DINAMICAMENTE -->
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div class="empty-title">Sua agenda est√° limpa</div>
                        <div class="empty-description">
                            Comece criando sua primeira tarefa ou evento para ver o grid semanal em a√ß√£o.
                        </div>
                        <button class="btn btn-primary" onclick="mostrarModalNovaTarefa()">
                            ‚ûï Criar Primeira Tarefa
                        </button>
                    </div>
                </div>
            </div>

            <!-- üìä BARRA DE ESTAT√çSTICAS -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">Total de Tarefas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div class="stat-label">Pendentes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="inProgressTasks">0</div>
                    <div class="stat-label">Em Andamento</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completedTasksTotal">0</div>
                    <div class="stat-label">Conclu√≠das</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="productivityScore">0%</div>
                    <div class="stat-label">Produtividade</div>
                </div>
            </div>
        </div>
    </div>

    <!-- üî• MODAIS DO SISTEMA DE TAREFAS -->
    
    <!-- ‚ûï MODAL NOVA TAREFA -->
    <div id="modalNovaTarefa" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Nova Tarefa Pessoal</h3>
                <button class="modal-close" onclick="fecharModal('modalNovaTarefa')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formNovaTarefa">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tarefaTitulo">üìù T√≠tulo da Tarefa *</label>
                            <input type="text" id="tarefaTitulo" name="titulo" required placeholder="Ex: Revisar documenta√ß√£o do projeto">
                        </div>
                        <div class="form-group">
                            <label for="tarefaTipo">üè∑Ô∏è Tipo</label>
                            <select id="tarefaTipo" name="tipo">
                                <option value="pessoal">üë§ Pessoal</option>
                                <option value="equipe">üë• Equipe</option>
                                <option value="projeto">üèóÔ∏è Projeto</option>
                                <option value="urgente">üö® Urgente</option>
                                <option value="rotina">üîÑ Rotina</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tarefaDescricao">üìÑ Descri√ß√£o</label>
                        <textarea id="tarefaDescricao" name="descricao" placeholder="Descreva os detalhes da tarefa..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tarefaDataInicio">üìÖ Data de In√≠cio</label>
                            <input type="date" id="tarefaDataInicio" name="dataInicio">
                        </div>
                        <div class="form-group">
                            <label for="tarefaHorario">üïê Hor√°rio</label>
                            <input type="time" id="tarefaHorario" name="horario">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tarefaPrioridade">üéØ Prioridade</label>
                            <select id="tarefaPrioridade" name="prioridade">
                                <option value="baixa">üü¢ Baixa</option>
                                <option value="media" selected>üü° M√©dia</option>
                                <option value="alta">üü† Alta</option>
                                <option value="critica">üî¥ Cr√≠tica</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="eventoRelacionado">üîó Evento Relacionado</label>
                            <select id="eventoRelacionado" name="eventoRelacionado">
                                <option value="">Nenhum evento</option>
                                <!-- Eventos ser√£o carregados dinamicamente -->
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üë• Marcar Outras Pessoas</label>
                        <div class="participantes-container" id="participantesContainer">
                            <input type="text" class="participante-input" id="participanteInput" placeholder="Digite um nome e pressione Enter">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üìã Subtarefas</label>
                        <div class="subtarefas-list" id="subtarefasList">
                            <div style="padding: 12px; text-align: center; color: #9ca3af;">
                                Nenhuma subtarefa adicionada
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="adicionarSubtarefa()" style="margin-top: 8px;">
                            ‚ûï Adicionar Subtarefa
                        </button>
                    </div>

                    <div class="form-checkbox">
                        <input type="checkbox" id="aparecerNoCalendario" name="aparecerNoCalendario">
                        <label for="aparecerNoCalendario">üìÖ Mostrar no calend√°rio principal</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="fecharModal('modalNovaTarefa')">
                    ‚ùå Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="salvarNovaTarefa()">
                    üíæ Salvar Tarefa
                </button>
            </div>
        </div>
    </div>

    <!-- ‚úèÔ∏è MODAL EDITAR TAREFA -->
    <div id="modalEditarTarefa" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Tarefa</h3>
                <button class="modal-close" onclick="fecharModal('modalEditarTarefa')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Formul√°rio id√™ntico ao de nova tarefa -->
                <form id="formEditarTarefa">
                    <!-- Mesmo conte√∫do do form de nova tarefa, mas com IDs diferentes -->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="confirmarExclusaoTarefa()">
                    üóëÔ∏è Excluir
                </button>
                <button type="button" class="btn btn-secondary" onclick="fecharModal('modalEditarTarefa')">
                    ‚ùå Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="salvarEdicaoTarefa()">
                    üíæ Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>

    <script>
        // üéØ CLASSE PRINCIPAL DA AGENDA DEDICADA INTEGRADA v2.0
        class AgendaDedicadaIntegrada {
            constructor() {
                this.visualizacaoAtiva = 'grid';
                this.semanaAtual = new Date();
                this.usuarioAtual = null;
                this.tarefas = [];
                this.eventos = [];
                this.participantesTemp = [];
                this.subtarefasTemp = [];
                this.tarefaEditando = null;
                this.filtros = {
                    tipo: 'todos',
                    status: 'todos',
                    prioridade: 'todos'
                };
                
                this.init();
            }

            // üöÄ INICIALIZA√á√ÉO
            async init() {
                console.log('üìÖ Inicializando Agenda Dedicada Integrada v2.0...');
                
                try {
                    // Aguardar m√≥dulos carregarem
                    await this.aguardarModulos();
                    
                    this.verificarUsuario();
                    await this.carregarDados();
                    this.configurarEventListeners();
                    this.renderizarGrid();
                    this.atualizarSemanaDisplay();
                    this.atualizarEstatisticas();
                    
                    console.log('‚úÖ Agenda Dedicada carregada com sucesso!');
                } catch (error) {
                    console.error('‚ùå Erro na inicializa√ß√£o:', error);
                    this.inicializarModoFallback();
                }
            }

            async aguardarModulos() {
                let tentativas = 0;
                const maxTentativas = 50; // 5 segundos
                
                while (tentativas < maxTentativas) {
                    if (typeof PersonalTasks !== 'undefined' && PersonalTasks.state.inicializado) {
                        console.log('‚úÖ PersonalTasks dispon√≠vel');
                        return;
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    tentativas++;
                }
                
                console.warn('‚ö†Ô∏è PersonalTasks n√£o carregou, usando modo fallback');
            }

            inicializarModoFallback() {
                console.log('üîÑ Inicializando modo fallback...');
                this.usuarioAtual = { nome: 'Usu√°rio Demo', email: 'demo@biapo.com.br' };
                this.tarefas = [];
                this.eventos = [];
                
                document.getElementById('userName').textContent = this.usuarioAtual.nome;
                document.getElementById('userEmail').textContent = this.usuarioAtual.email;
                
                this.renderizarGrid();
                this.atualizarSemanaDisplay();
                this.atualizarEstatisticas();
            }

            // üë§ VERIFICAR USU√ÅRIO LOGADO
            verificarUsuario() {
                try {
                    if (typeof PersonalTasks !== 'undefined' && PersonalTasks.state.usuarioAtual) {
                        this.usuarioAtual = {
                            nome: PersonalTasks.state.usuarioAtual,
                            email: this.obterEmailUsuario()
                        };
                    } else if (App && App.usuarioAtual) {
                        this.usuarioAtual = {
                            nome: App.usuarioAtual.displayName || this.extrairNomeDoEmail(App.usuarioAtual.email),
                            email: App.usuarioAtual.email
                        };
                    } else {
                        this.usuarioAtual = {
                            nome: 'Usu√°rio Demo',
                            email: 'demo@biapo.com.br'
                        };
                    }

                    document.getElementById('userName').textContent = this.usuarioAtual.nome;
                    document.getElementById('userEmail').textContent = this.usuarioAtual.email;

                } catch (error) {
                    console.error('‚ùå Erro ao verificar usu√°rio:', error);
                    this.inicializarModoFallback();
                }
            }

            obterEmailUsuario() {
                try {
                    if (App && App.usuarioAtual && App.usuarioAtual.email) {
                        return App.usuarioAtual.email;
                    }
                    if (Auth && Auth.state && Auth.state.usuario && Auth.state.usuario.email) {
                        return Auth.state.usuario.email;
                    }
                    return 'demo@biapo.com.br';
                } catch (error) {
                    return 'demo@biapo.com.br';
                }
            }

            extrairNomeDoEmail(email) {
                if (!email) return 'Usu√°rio';
                const parteLocal = email.split('@')[0];
                return parteLocal.charAt(0).toUpperCase() + parteLocal.slice(1);
            }

            // üìä CARREGAR DADOS
            async carregarDados() {
                try {
                    // Carregar tarefas do PersonalTasks
                    if (typeof PersonalTasks !== 'undefined') {
                        this.tarefas = PersonalTasks.obterTarefasUsuario() || [];
                        console.log(`üìã ${this.tarefas.length} tarefas pessoais carregadas`);
                    }

                    // Carregar eventos da equipe onde usu√°rio √© participante
                    if (App && App.dados && App.dados.eventos) {
                        this.eventos = App.dados.eventos.filter(evento => {
                            return evento.participantes && evento.participantes.includes(this.usuarioAtual.nome);
                        });
                        console.log(`üìÖ ${this.eventos.length} eventos da equipe carregados`);
                    }

                } catch (error) {
                    console.error('‚ùå Erro ao carregar dados:', error);
                    this.tarefas = [];
                    this.eventos = [];
                }
            }

            // üéõÔ∏è CONFIGURAR EVENT LISTENERS
            configurarEventListeners() {
                // Filtros
                document.getElementById('filtroTipo').addEventListener('change', () => {
                    this.filtros.tipo = document.getElementById('filtroTipo').value;
                    this.aplicarFiltros();
                });

                document.getElementById('filtroStatus').addEventListener('change', () => {
                    this.filtros.status = document.getElementById('filtroStatus').value;
                    this.aplicarFiltros();
                });

                document.getElementById('filtroPrioridade').addEventListener('change', () => {
                    this.filtros.prioridade = document.getElementById('filtroPrioridade').value;
                    this.aplicarFiltros();
                });

                // Participantes input
                const participanteInput = document.getElementById('participanteInput');
                if (participanteInput) {
                    participanteInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.adicionarParticipante();
                        }
                    });
                }

                // Sync em tempo real do PersonalTasks
                if (typeof PersonalTasks !== 'undefined') {
                    window.addEventListener('personal-tasks-sync', () => {
                        this.carregarDados();
                        this.renderizarGrid();
                        this.atualizarEstatisticas();
                    });
                }
            }

            // üóìÔ∏è RENDERIZAR GRID SEMANAL DIN√ÇMICO
            renderizarGrid() {
                const grid = document.getElementById('weeklyGrid');
                const tarefasFiltradas = this.filtrarTarefas();
                const eventosFiltrados = this.eventos;

                if (tarefasFiltradas.length === 0 && eventosFiltrados.length === 0) {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <div class="empty-title">Sua agenda est√° limpa</div>
                            <div class="empty-description">
                                Comece criando sua primeira tarefa para ver o grid semanal em a√ß√£o.
                            </div>
                            <button class="btn btn-primary" onclick="mostrarModalNovaTarefa()">
                                ‚ûï Criar Primeira Tarefa
                            </button>
                        </div>
                    `;
                    return;
                }

                this.renderizarGridCompleto(grid, tarefasFiltradas, eventosFiltrados);
            }

            renderizarGridCompleto(grid, tarefas, eventos) {
                const hoje = new Date();
                const inicioSemana = new Date(this.semanaAtual);
                inicioSemana.setDate(this.semanaAtual.getDate() - this.semanaAtual.getDay());

                grid.innerHTML = `
                    <!-- Coluna de hor√°rios -->
                    <div class="time-column">
                        <div style="font-size: 12px; color: var(--biapo-red); font-weight: 700;">HOR√ÅRIOS</div>
                    </div>

                    <!-- Cabe√ßalhos dos dias -->
                    ${this.gerarCabecalhosDias(inicioSemana, hoje)}

                    <!-- Slots de hor√°rio -->
                    <div class="time-slots">
                        ${Array.from({length: 10}, (_, i) => {
                            const hora = String(8 + i).padStart(2, '0');
                            return `<div class="time-slot">${hora}:00</div>`;
                        }).join('')}
                    </div>

                    <!-- Colunas dos dias -->
                    ${this.gerarColunasDias(inicioSemana, tarefas, eventos)}
                `;

                this.adicionarLinhaTempo(grid);
            }

            gerarCabecalhosDias(inicioSemana, hoje) {
                const diasSemana = ['DOM', 'SEG', 'TER', 'QUA', 'QUI', 'SEX', 'S√ÅB'];
                let html = '';

                for (let i = 0; i < 7; i++) {
                    const dia = new Date(inicioSemana);
                    dia.setDate(inicioSemana.getDate() + i);
                    
                    const ehHoje = dia.toDateString() === hoje.toDateString();
                    const itensTotal = this.obterItensDoDia(dia).length;

                    html += `
                        <div class="day-header ${ehHoje ? 'today' : ''}">
                            <div class="day-name">${diasSemana[i]}</div>
                            <div class="day-date">${dia.getDate()}</div>
                            <div class="day-tasks-count">${itensTotal} itens</div>
                        </div>
                    `;
                }

                return html;
            }

            gerarColunasDias(inicioSemana, tarefas, eventos) {
                let html = '';

                for (let i = 0; i < 7; i++) {
                    const dia = new Date(inicioSemana);
                    dia.setDate(inicioSemana.getDate() + i);
                    const itensDia = this.obterItensDoDia(dia, tarefas, eventos);

                    html += `
                        <div class="day-column">
                            ${Array.from({length: 10}, (_, h) => {
                                const hora = 8 + h;
                                const itensHora = itensDia.filter(item => {
                                    const horarioItem = parseInt(item.horario?.split(':')[0] || '0');
                                    return horarioItem === hora;
                                });

                                return `
                                    <div class="hour-slot" onclick="criarTarefaRapida('${dia.toISOString().split('T')[0]}', '${String(hora).padStart(2, '0')}:00')">
                                        ${itensHora.map(item => this.renderizarItemGrid(item)).join('')}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }

                return html;
            }

            obterItensDoDia(dia, tarefas = null, eventos = null) {
                const tarefasParaFiltrar = tarefas || this.tarefas;
                const eventosParaFiltrar = eventos || this.eventos;
                const dataStr = dia.toISOString().split('T')[0];
                
                let itens = [];

                // Tarefas pessoais
                itens = itens.concat(tarefasParaFiltrar.filter(tarefa => 
                    tarefa.dataInicio === dataStr
                ));

                // Eventos da equipe
                itens = itens.concat(eventosParaFiltrar.filter(evento => 
                    evento.data === dataStr || evento.dataInicio === dataStr
                ));

                return itens;
            }

            renderizarItemGrid(item) {
                const tipoClass = item.tipo || 'pessoal';
                const prioridade = item.prioridade || 'media';
                const ehEvento = item.hasOwnProperty('participantes') && !item.hasOwnProperty('responsavel');

                return `
                    <div class="task-item ${tipoClass} fade-in" onclick="${ehEvento ? `editarEvento('${item.id}')` : `editarTarefa('${item.id}')`}">
                        <div class="task-time">${item.horario || ''}</div>
                        <div class="task-title">${ehEvento ? 'üìÖ ' : 'üìã '}${item.titulo}</div>
                        ${item.descricao ? `<div class="task-description">${item.descricao}</div>` : ''}
                        <div class="task-meta">
                            <div class="task-priority ${prioridade}">${prioridade}</div>
                            <div class="task-indicators">
                                ${ehEvento ? '<span class="task-indicator">üë•</span>' : ''}
                                ${item.subtarefas?.length > 0 ? '<span class="task-indicator">üìã</span>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            adicionarLinhaTempo(grid) {
                const agora = new Date();
                const hora = agora.getHours();
                const minuto = agora.getMinutes();

                if (hora >= 8 && hora <= 17) {
                    const posicao = ((hora - 8) * 60) + minuto;
                    const linha = document.createElement('div');
                    linha.className = 'current-time-line';
                    linha.style.top = `${posicao}px`;
                    
                    const hoje = new Date();
                    const diaHoje = hoje.getDay();
                    const colunaHoje = grid.querySelector(`.day-column:nth-child(${diaHoje + 2})`);
                    if (colunaHoje) {
                        colunaHoje.appendChild(linha);
                    }
                }
            }

            // üìä ATUALIZAR DISPLAY DA SEMANA
            atualizarSemanaDisplay() {
                const inicioSemana = new Date(this.semanaAtual);
                inicioSemana.setDate(this.semanaAtual.getDate() - this.semanaAtual.getDay());
                
                const fimSemana = new Date(inicioSemana);
                fimSemana.setDate(inicioSemana.getDate() + 6);

                const display = `${inicioSemana.getDate()} - ${fimSemana.getDate()} ${fimSemana.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}`;
                document.getElementById('currentWeekDisplay').textContent = display;
            }

            // üîç FILTRAR TAREFAS
            filtrarTarefas() {
                return this.tarefas.filter(tarefa => {
                    if (this.filtros.tipo !== 'todos' && tarefa.tipo !== this.filtros.tipo) return false;
                    if (this.filtros.status !== 'todos' && tarefa.status !== this.filtros.status) return false;
                    if (this.filtros.prioridade !== 'todos' && tarefa.prioridade !== this.filtros.prioridade) return false;
                    return true;
                });
            }

            // üìä ATUALIZAR ESTAT√çSTICAS
            atualizarEstatisticas() {
                const tarefasFiltradas = this.filtrarTarefas();
                const pendentes = tarefasFiltradas.filter(t => t.status === 'pendente').length;
                const andamento = tarefasFiltradas.filter(t => t.status === 'andamento').length;
                const concluidas = tarefasFiltradas.filter(t => t.status === 'concluida').length;
                const produtividade = tarefasFiltradas.length > 0 ? Math.round((concluidas / tarefasFiltradas.length) * 100) : 0;

                document.getElementById('totalTasks').textContent = tarefasFiltradas.length;
                document.getElementById('pendingTasks').textContent = pendentes;
                document.getElementById('inProgressTasks').textContent = andamento;
                document.getElementById('completedTasksTotal').textContent = concluidas;
                document.getElementById('productivityScore').textContent = produtividade + '%';
            }

            // üîÑ APLICAR FILTROS
            aplicarFiltros() {
                this.renderizarGrid();
                this.atualizarEstatisticas();
            }

            // üìÖ NAVEGAR SEMANA
            navegarSemana(direcao) {
                this.semanaAtual.setDate(this.semanaAtual.getDate() + (direcao * 7));
                this.atualizarSemanaDisplay();
                this.renderizarGrid();
            }

            irParaHoje() {
                this.semanaAtual = new Date();
                this.atualizarSemanaDisplay();
                this.renderizarGrid();
            }

            // üë• GERENCIAR PARTICIPANTES
            adicionarParticipante() {
                const input = document.getElementById('participanteInput');
                const nome = input.value.trim();
                
                if (nome && !this.participantesTemp.includes(nome)) {
                    this.participantesTemp.push(nome);
                    this.renderizarParticipantes();
                    input.value = '';
                }
            }

            removerParticipante(nome) {
                this.participantesTemp = this.participantesTemp.filter(p => p !== nome);
                this.renderizarParticipantes();
            }

            renderizarParticipantes() {
                const container = document.getElementById('participantesContainer');
                const input = container.querySelector('.participante-input');
                
                container.innerHTML = '';
                
                this.participantesTemp.forEach(nome => {
                    const tag = document.createElement('div');
                    tag.className = 'participante-tag';
                    tag.innerHTML = `
                        ${nome}
                        <span class="remove" onclick="agendaDedicada.removerParticipante('${nome}')">&times;</span>
                    `;
                    container.appendChild(tag);
                });
                
                container.appendChild(input);
            }

            // üìã GERENCIAR SUBTAREFAS
            adicionarSubtarefa() {
                const titulo = prompt('üìù T√≠tulo da subtarefa:');
                if (titulo && titulo.trim()) {
                    this.subtarefasTemp.push({
                        id: Date.now(),
                        titulo: titulo.trim(),
                        concluida: false
                    });
                    this.renderizarSubtarefas();
                }
            }

            toggleSubtarefa(id) {
                const subtarefa = this.subtarefasTemp.find(s => s.id === id);
                if (subtarefa) {
                    subtarefa.concluida = !subtarefa.concluida;
                    this.renderizarSubtarefas();
                }
            }

            removerSubtarefa(id) {
                this.subtarefasTemp = this.subtarefasTemp.filter(s => s.id !== id);
                this.renderizarSubtarefas();
            }

            renderizarSubtarefas() {
                const container = document.getElementById('subtarefasList');
                
                if (this.subtarefasTemp.length === 0) {
                    container.innerHTML = `
                        <div style="padding: 12px; text-align: center; color: #9ca3af;">
                            Nenhuma subtarefa adicionada
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.subtarefasTemp.map(subtarefa => `
                    <div class="subtarefa-item">
                        <input type="checkbox" class="subtarefa-checkbox" ${subtarefa.concluida ? 'checked' : ''} 
                               onchange="agendaDedicada.toggleSubtarefa(${subtarefa.id})">
                        <span class="subtarefa-texto ${subtarefa.concluida ? 'concluida' : ''}">${subtarefa.titulo}</span>
                        <div class="subtarefa-actions">
                            <button class="btn-icon" onclick="agendaDedicada.removerSubtarefa(${subtarefa.id})" title="Remover">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // üíæ SALVAR TAREFA
            async salvarNovaTarefa() {
                try {
                    const form = document.getElementById('formNovaTarefa');
                    const formData = new FormData(form);
                    
                    const dadosTarefa = {
                        titulo: formData.get('titulo'),
                        descricao: formData.get('descricao'),
                        tipo: formData.get('tipo'),
                        prioridade: formData.get('prioridade'),
                        dataInicio: formData.get('dataInicio') || new Date().toISOString().split('T')[0],
                        horario: formData.get('horario'),
                        eventoRelacionado: formData.get('eventoRelacionado') || null,
                        participantes: [...this.participantesTemp],
                        subtarefas: [...this.subtarefasTemp],
                        aparecerNoCalendario: document.getElementById('aparecerNoCalendario').checked
                    };

                    if (typeof PersonalTasks !== 'undefined') {
                        await PersonalTasks.criarTarefa(dadosTarefa);
                        this.notificar('‚úÖ Tarefa criada com sucesso!', 'success');
                    } else {
                        // Fallback local
                        dadosTarefa.id = Date.now();
                        this.tarefas.push(dadosTarefa);
                        this.notificar('‚úÖ Tarefa criada (modo local)!', 'warning');
                    }

                    this.fecharModal('modalNovaTarefa');
                    this.limparFormulario();
                    await this.carregarDados();
                    this.renderizarGrid();
                    this.atualizarEstatisticas();

                } catch (error) {
                    console.error('‚ùå Erro ao salvar tarefa:', error);
                    this.notificar('‚ùå Erro ao salvar tarefa: ' + error.message, 'error');
                }
            }

            limparFormulario() {
                document.getElementById('formNovaTarefa').reset();
                this.participantesTemp = [];
                this.subtarefasTemp = [];
                this.renderizarParticipantes();
                this.renderizarSubtarefas();
            }

            // üîî NOTIFICA√á√ÉO
            notificar(mensagem, tipo = 'info') {
                if (typeof Notifications !== 'undefined') {
                    Notifications[tipo](mensagem);
                } else {
                    console.log(`${tipo.toUpperCase()}: ${mensagem}`);
                    // Fallback simples
                    const notification = document.getElementById('notification');
                    const text = document.getElementById('notificationText');
                    if (notification && text) {
                        text.textContent = mensagem;
                        notification.style.display = 'block';
                        setTimeout(() => {
                            notification.style.display = 'none';
                        }, 3000);
                    }
                }
            }

            // üîß UTILIT√ÅRIOS
            fecharModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('show');
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                }
            }

            abrirModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                    setTimeout(() => {
                        modal.classList.add('show');
                    }, 10);
                }
            }
        }

        // üöÄ INST√ÇNCIA GLOBAL
        let agendaDedicada;

        // üìã FUN√á√ïES GLOBAIS DA INTERFACE
        function alternarVisualizacao(tipo) {
            agendaDedicada.visualizacaoAtiva = tipo;
            
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-view="${tipo}"]`).classList.add('active');

            if (tipo === 'list') {
                alert('üìã Visualiza√ß√£o em lista ser√° implementada em breve!');
                document.querySelector('[data-view="grid"]').classList.add('active');
                document.querySelector('[data-view="list"]').classList.remove('active');
            }
        }

        function aplicarFiltros() {
            agendaDedicada.aplicarFiltros();
        }

        function navegarSemana(direcao) {
            agendaDedicada.navegarSemana(direcao);
        }

        function irParaHoje() {
            agendaDedicada.irParaHoje();
        }

        function mostrarModalNovaTarefa() {
            agendaDedicada.limparFormulario();
            agendaDedicada.abrirModal('modalNovaTarefa');
            
            // Definir data padr√£o como hoje
            document.getElementById('tarefaDataInicio').value = new Date().toISOString().split('T')[0];
        }

        function editarTarefa(id) {
            console.log(`‚úèÔ∏è Editando tarefa ID: ${id}`);
            // TODO: Implementar edi√ß√£o de tarefa
            alert('üöß Edi√ß√£o de tarefas ser√° implementada em breve!');
        }

        function editarEvento(id) {
            console.log(`üìÖ Visualizando evento ID: ${id}`);
            alert('üìÖ Evento da equipe - Use o sistema principal para editar');
        }

        function criarTarefaRapida(data, horario) {
            console.log(`üöÄ Cria√ß√£o r√°pida: ${data} √†s ${horario}`);
            mostrarModalNovaTarefa();
            document.getElementById('tarefaDataInicio').value = data;
            document.getElementById('tarefaHorario').value = horario;
        }

        function salvarNovaTarefa() {
            agendaDedicada.salvarNovaTarefa();
        }

        function adicionarSubtarefa() {
            agendaDedicada.adicionarSubtarefa();
        }

        function fecharModal(modalId) {
            agendaDedicada.fecharModal(modalId);
        }

        function sincronizarDados() {
            if (typeof PersonalTasks !== 'undefined') {
                PersonalTasks.recarregarTarefas();
                agendaDedicada.notificar('üîÑ Sincroniza√ß√£o iniciada!', 'info');
            } else {
                agendaDedicada.notificar('üîÑ Modo local - sem sincroniza√ß√£o', 'warning');
            }
        }

        function sincronizarTudo() {
            Promise.all([
                sincronizarDados(),
                agendaDedicada.carregarDados()
            ]).then(() => {
                agendaDedicada.renderizarGrid();
                agendaDedicada.atualizarEstatisticas();
                agendaDedicada.notificar('‚úÖ Sincroniza√ß√£o completa!', 'success');
            });
        }

        function exportarAgenda() {
            agendaDedicada.notificar('üìÑ Exporta√ß√£o ser√° implementada em breve!', 'info');
        }

        function mostrarRelatorios() {
            agendaDedicada.notificar('üìä Relat√≥rios ser√£o implementados em breve!', 'info');
        }

        function voltarParaSistema() {
            window.location.href = 'index.html';
        }

        // üöÄ INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÖ Inicializando Agenda Dedicada Integrada v2.0...');
            
            setTimeout(() => {
                agendaDedicada = new AgendaDedicadaIntegrada();
            }, 1000);
        });

        // ‚è∞ ATUALIZAR LINHA DO TEMPO A CADA MINUTO
        setInterval(() => {
            if (agendaDedicada) {
                agendaDedicada.renderizarGrid();
            }
        }, 60000);

        // üîß EVENTOS DE TECLADO
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                    setTimeout(() => modal.style.display = 'none', 300);
                });
            }
        });
    </script>
</body>
</html>
