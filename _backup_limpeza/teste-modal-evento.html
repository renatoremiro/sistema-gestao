<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Modal Evento - Sistema BIAPO</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Sistema -->
    <script src="assets/js/config/firebase.js"></script>
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/validation.js"></script>
    <script src="assets/js/utils/notifications.js"></script>
    <script src="assets/js/core/data.js"></script>
    <script src="assets/js/core/app.js"></script>
    <script src="assets/js/modules/persistence.js"></script>
    <script src="assets/js/modules/auth.js"></script>
    <script src="assets/js/modules/events.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #C53030;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #9B2C2C;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste Modal de Eventos - Sistema BIAPO v8.12.2</h1>
        
        <div class="status">
            <h3>Status do Sistema:</h3>
            <div id="status">Carregando...</div>
        </div>
        
        <h3>Testes Dispon√≠veis:</h3>
        
        <button class="test-button" onclick="testarModalNovoEvento()">
            üìÖ Abrir Modal Novo Evento
        </button>
        
        <button class="test-button" onclick="testarCriarEvento()">
            üß™ Criar Evento de Teste
        </button>
        
        <button class="test-button" onclick="verificarModulos()">
            üîç Verificar M√≥dulos
        </button>
        
        <button class="test-button" onclick="limparDados()">
            üóëÔ∏è Limpar Dados de Teste
        </button>
        
        <div class="status">
            <h3>Log de Testes:</h3>
            <div id="log" style="font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;"></div>
        </div>
    </div>

    <script>
        function log(mensagem) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${mensagem}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(mensagem);
        }

        function atualizarStatus() {
            const statusDiv = document.getElementById('status');
            let status = '';
            
            // Verificar m√≥dulos
            status += `App.js: ${typeof App !== 'undefined' ? '‚úÖ' : '‚ùå'}<br>`;
            status += `Auth.js: ${typeof Auth !== 'undefined' ? '‚úÖ' : '‚ùå'}<br>`;
            status += `Events.js: ${typeof Events !== 'undefined' ? '‚úÖ' : '‚ùå'}<br>`;
            
            if (typeof App !== 'undefined') {
                status += `App inicializado: ${App.estadoSistema?.inicializado ? '‚úÖ' : '‚ùå'}<br>`;
                status += `Firebase: ${App.estadoSistema?.firebaseDisponivel ? '‚úÖ' : '‚ö†Ô∏è Offline'}<br>`;
            }
            
            if (typeof Events !== 'undefined') {
                status += `Modal ativo: ${Events.state?.modalAtivo ? '‚úÖ' : '‚ùå'}<br>`;
            }
            
            statusDiv.innerHTML = status;
        }

        function testarModalNovoEvento() {
            log('üß™ Testando modal de novo evento...');
            
            if (typeof Events === 'undefined') {
                log('‚ùå Events.js n√£o carregado!');
                return;
            }
            
            try {
                Events.mostrarNovoEvento();
                log('‚úÖ Modal de novo evento aberto');
                setTimeout(atualizarStatus, 100);
            } catch (error) {
                log(`‚ùå Erro ao abrir modal: ${error.message}`);
            }
        }

        function testarCriarEvento() {
            log('üß™ Testando cria√ß√£o de evento...');
            
            if (typeof App === 'undefined') {
                log('‚ùå App.js n√£o carregado!');
                return;
            }
            
            if (typeof App.criarEvento !== 'function') {
                log('‚ùå App.criarEvento n√£o dispon√≠vel!');
                return;
            }
            
            const eventoTeste = {
                titulo: 'Evento de Teste ' + new Date().toLocaleTimeString(),
                tipo: 'reuniao',
                data: new Date().toISOString().split('T')[0],
                descricao: 'Evento criado pelo teste autom√°tico',
                participantes: ['Renato Remiro'],
                criadoPor: 'teste@biapo.com.br'
            };
            
            App.criarEvento(eventoTeste)
                .then(evento => {
                    log(`‚úÖ Evento criado com sucesso: "${evento.titulo}" (ID: ${evento.id})`);
                    atualizarStatus();
                })
                .catch(error => {
                    log(`‚ùå Erro ao criar evento: ${error.message}`);
                });
        }

        function verificarModulos() {
            log('üîç Verificando m√≥dulos...');
            
            // Verificar App.js
            if (typeof App !== 'undefined') {
                log('‚úÖ App.js carregado');
                log(`   Vers√£o: ${App.config?.versao || 'N/A'}`);
                log(`   Inicializado: ${App.estadoSistema?.inicializado ? 'SIM' : 'N√ÉO'}`);
                log(`   Firebase: ${App.estadoSistema?.firebaseDisponivel ? 'ONLINE' : 'OFFLINE'}`);
                log(`   criarEvento: ${typeof App.criarEvento === 'function' ? '‚úÖ' : '‚ùå'}`);
                log(`   editarEvento: ${typeof App.editarEvento === 'function' ? '‚úÖ' : '‚ùå'}`);
            } else {
                log('‚ùå App.js n√£o carregado');
            }
            
            // Verificar Events.js
            if (typeof Events !== 'undefined') {
                log('‚úÖ Events.js carregado');
                log(`   Vers√£o: ${Events.config?.versao || 'N/A'}`);
                log(`   mostrarNovoEvento: ${typeof Events.mostrarNovoEvento === 'function' ? '‚úÖ' : '‚ùå'}`);
                log(`   _submeterFormulario: ${typeof Events._submeterFormulario === 'function' ? '‚úÖ' : '‚ùå'}`);
            } else {
                log('‚ùå Events.js n√£o carregado');
            }
            
            // Verificar Auth.js
            if (typeof Auth !== 'undefined') {
                log('‚úÖ Auth.js carregado');
                log(`   Vers√£o: ${Auth.config?.versao || 'N/A'}`);
                log(`   listarUsuarios: ${typeof Auth.listarUsuarios === 'function' ? '‚úÖ' : '‚ùå'}`);
            } else {
                log('‚ùå Auth.js n√£o carregado');
            }
        }

        function limparDados() {
            log('üóëÔ∏è Limpando dados de teste...');
            
            // Limpar localStorage
            localStorage.removeItem('biapo_eventos');
            localStorage.removeItem('biapo_eventos_timestamp');
            localStorage.removeItem('biapo_dados_v8');
            localStorage.removeItem('biapo_dados_timestamp');
            
            log('‚úÖ Dados de teste removidos');
            
            // Recarregar App se dispon√≠vel
            if (typeof App !== 'undefined' && App.init) {
                App.init();
                log('üîÑ App.js reinicializado');
            }
            
            setTimeout(atualizarStatus, 100);
        }

        // Inicializar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina carregada - iniciando testes...');
            
            // Aguardar carregamento dos m√≥dulos
            setTimeout(() => {
                atualizarStatus();
                verificarModulos();
            }, 1000);
        });

        // Atualizar status periodicamente
        setInterval(atualizarStatus, 2000);
    </script>
</body>
</html> 