<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste IntegraÃ§Ã£o Completa - Sistema BIAPO v8.12.2</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Sistema -->
    <script src="assets/js/config/firebase.js"></script>
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/validation.js"></script>
    <script src="assets/js/utils/notifications.js"></script>
    <script src="assets/js/core/data.js"></script>
    <script src="assets/js/core/app.js"></script>
    <script src="assets/js/modules/persistence.js"></script>
    <script src="assets/js/modules/auth.js"></script>
    <script src="assets/js/modules/events.js"></script>
    <script src="assets/js/modules/calendar.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-button {
            background: #C53030;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #9B2C2C;
        }
        .test-button.success {
            background: #059669;
        }
        .test-button.warning {
            background: #f59e0b;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .status-card {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            background: #f8fafc;
        }
        .status-card.success {
            border-color: #059669;
            background: #f0fdf4;
        }
        .status-card.error {
            border-color: #dc2626;
            background: #fef2f2;
        }
        .log {
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Teste IntegraÃ§Ã£o Completa - Sistema BIAPO v8.12.2</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š Status dos MÃ³dulos</h3>
            <div id="status-modulos" class="status-grid">
                <div class="status-card">
                    <h4>App.js</h4>
                    <div id="status-app">Carregando...</div>
                </div>
                <div class="status-card">
                    <h4>Auth.js</h4>
                    <div id="status-auth">Carregando...</div>
                </div>
                <div class="status-card">
                    <h4>Events.js</h4>
                    <div id="status-events">Carregando...</div>
                </div>
                <div class="status-card">
                    <h4>Calendar.js</h4>
                    <div id="status-calendar">Carregando...</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”§ Testes de IntegraÃ§Ã£o</h3>
            
            <h4>1. Teste de CriaÃ§Ã£o de Eventos</h4>
            <button class="test-button" onclick="testarCriacaoEventos()">
                ğŸ“… Criar Evento de Teste
            </button>
            <button class="test-button" onclick="testarModalEvento()">
                ğŸ¯ Abrir Modal Evento
            </button>
            
            <h4>2. Teste de SincronizaÃ§Ã£o</h4>
            <button class="test-button" onclick="testarSincronizacao()">
                ğŸ”„ Testar SincronizaÃ§Ã£o
            </button>
            <button class="test-button" onclick="verificarEventos()">
                ğŸ“‹ Verificar Eventos
            </button>
            
            <h4>3. Teste de PermissÃµes</h4>
            <button class="test-button" onclick="testarPermissoes()">
                ğŸ” Testar PermissÃµes
            </button>
            <button class="test-button" onclick="simularLogin()">
                ğŸ‘¤ Simular Login
            </button>
            
            <h4>4. Teste de CalendÃ¡rio</h4>
            <button class="test-button" onclick="testarCalendario()">
                ğŸ“… Testar CalendÃ¡rio
            </button>
            <button class="test-button" onclick="verificarIntegracaoCalendario()">
                ğŸ”— Verificar IntegraÃ§Ã£o
            </button>
            
            <h4>5. Limpeza</h4>
            <button class="test-button warning" onclick="limparDadosTeste()">
                ğŸ—‘ï¸ Limpar Dados de Teste
            </button>
            <button class="test-button" onclick="executarTesteCompleto()">
                ğŸš€ Executar Teste Completo
            </button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ Log de Testes</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        let testesExecutados = 0;
        let testesSucesso = 0;
        
        function log(mensagem, tipo = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const emoji = tipo === 'success' ? 'âœ…' : tipo === 'error' ? 'âŒ' : tipo === 'warning' ? 'âš ï¸' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${emoji} ${mensagem}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`${emoji} ${mensagem}`);
        }

        function atualizarStatusModulos() {
            // App.js
            const statusApp = document.getElementById('status-app');
            if (typeof App !== 'undefined') {
                const status = App.obterStatusSistema();
                statusApp.innerHTML = `
                    <div>âœ… Carregado</div>
                    <div>VersÃ£o: ${status.versao}</div>
                    <div>Inicializado: ${status.inicializado ? 'SIM' : 'NÃƒO'}</div>
                    <div>Firebase: ${status.firebaseDisponivel ? 'ONLINE' : 'OFFLINE'}</div>
                    <div>Eventos: ${status.totalEventos}</div>
                    <div>Tarefas: ${status.totalTarefas}</div>
                `;
                statusApp.parentElement.className = 'status-card success';
            } else {
                statusApp.innerHTML = 'âŒ NÃ£o carregado';
                statusApp.parentElement.className = 'status-card error';
            }
            
            // Auth.js
            const statusAuth = document.getElementById('status-auth');
            if (typeof Auth !== 'undefined') {
                const status = Auth.obterStatus();
                statusAuth.innerHTML = `
                    <div>âœ… Carregado</div>
                    <div>VersÃ£o: ${status.versao}</div>
                    <div>Logado: ${status.logado ? 'SIM' : 'NÃƒO'}</div>
                    <div>UsuÃ¡rios: ${status.totalUsuarios}</div>
                `;
                statusAuth.parentElement.className = 'status-card success';
            } else {
                statusAuth.innerHTML = 'âŒ NÃ£o carregado';
                statusAuth.parentElement.className = 'status-card error';
            }
            
            // Events.js
            const statusEvents = document.getElementById('status-events');
            if (typeof Events !== 'undefined') {
                const status = Events.obterStatus();
                statusEvents.innerHTML = `
                    <div>âœ… Carregado</div>
                    <div>VersÃ£o: ${status.versao}</div>
                    <div>Modal: ${status.modalAtivo ? 'ATIVO' : 'INATIVO'}</div>
                    <div>Participantes: ${status.participantes.total}</div>
                `;
                statusEvents.parentElement.className = 'status-card success';
            } else {
                statusEvents.innerHTML = 'âŒ NÃ£o carregado';
                statusEvents.parentElement.className = 'status-card error';
            }
            
            // Calendar.js
            const statusCalendar = document.getElementById('status-calendar');
            if (typeof Calendar !== 'undefined') {
                const status = Calendar.obterStatus();
                statusCalendar.innerHTML = `
                    <div>âœ… Carregado</div>
                    <div>VersÃ£o: ${status.versao}</div>
                    <div>Carregado: ${status.carregado ? 'SIM' : 'NÃƒO'}</div>
                    <div>MÃªs: ${status.mesAtual}/${status.anoAtual}</div>
                `;
                statusCalendar.parentElement.className = 'status-card success';
            } else {
                statusCalendar.innerHTML = 'âŒ NÃ£o carregado';
                statusCalendar.parentElement.className = 'status-card error';
            }
        }

        async function testarCriacaoEventos() {
            log('ğŸ§ª Testando criaÃ§Ã£o de eventos...');
            testesExecutados++;
            
            try {
                if (typeof App === 'undefined') {
                    throw new Error('App.js nÃ£o carregado');
                }
                
                const eventoTeste = {
                    titulo: 'Evento de IntegraÃ§Ã£o ' + new Date().toLocaleTimeString(),
                    tipo: 'reuniao',
                    data: new Date().toISOString().split('T')[0],
                    descricao: 'Evento criado pelo teste de integraÃ§Ã£o',
                    participantes: ['Renato Remiro'],
                    criadoPor: 'teste@biapo.com.br'
                };
                
                const evento = await App.criarEvento(eventoTeste);
                log(`âœ… Evento criado com sucesso: "${evento.titulo}" (ID: ${evento.id})`, 'success');
                testesSucesso++;
                
                // Verificar se apareceu no calendÃ¡rio
                setTimeout(() => {
                    if (typeof Calendar !== 'undefined') {
                        Calendar.atualizarEventos();
                        log('âœ… CalendÃ¡rio atualizado apÃ³s criaÃ§Ã£o do evento', 'success');
                    }
                }, 500);
                
            } catch (error) {
                log(`âŒ Erro ao criar evento: ${error.message}`, 'error');
            }
        }

        function testarModalEvento() {
            log('ğŸ§ª Testando modal de eventos...');
            testesExecutados++;
            
            try {
                if (typeof Events === 'undefined') {
                    throw new Error('Events.js nÃ£o carregado');
                }
                
                Events.mostrarNovoEvento();
                log('âœ… Modal de evento aberto com sucesso', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro ao abrir modal: ${error.message}`, 'error');
            }
        }

        async function testarSincronizacao() {
            log('ğŸ§ª Testando sincronizaÃ§Ã£o entre mÃ³dulos...');
            testesExecutados++;
            
            try {
                // Verificar se App.js estÃ¡ sincronizando
                if (typeof App !== 'undefined' && App._salvarDadosUnificados) {
                    await App._salvarDadosUnificados();
                    log('âœ… App.js sincronizado', 'success');
                }
                
                // Verificar se Calendar.js estÃ¡ escutando eventos
                if (typeof Calendar !== 'undefined') {
                    Calendar.atualizarEventos();
                    log('âœ… Calendar.js atualizado', 'success');
                }
                
                log('âœ… SincronizaÃ§Ã£o testada com sucesso', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro na sincronizaÃ§Ã£o: ${error.message}`, 'error');
            }
        }

        function verificarEventos() {
            log('ğŸ§ª Verificando eventos existentes...');
            testesExecutados++;
            
            try {
                if (typeof App === 'undefined') {
                    throw new Error('App.js nÃ£o carregado');
                }
                
                const eventos = App.dados.eventos || [];
                const tarefas = App.dados.tarefas || [];
                
                log(`ğŸ“Š Total de eventos: ${eventos.length}`);
                log(`ğŸ“Š Total de tarefas: ${tarefas.length}`);
                
                if (eventos.length > 0) {
                    log(`ğŸ“… Ãšltimo evento: "${eventos[eventos.length - 1].titulo}"`);
                }
                
                log('âœ… VerificaÃ§Ã£o de eventos concluÃ­da', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro ao verificar eventos: ${error.message}`, 'error');
            }
        }

        function testarPermissoes() {
            log('ğŸ§ª Testando sistema de permissÃµes...');
            testesExecutados++;
            
            try {
                if (typeof App === 'undefined') {
                    throw new Error('App.js nÃ£o carregado');
                }
                
                const podeEditar = App.podeEditar();
                const ehAdmin = App.ehAdmin();
                
                log(`ğŸ” Pode editar: ${podeEditar ? 'SIM' : 'NÃƒO'}`);
                log(`ğŸ‘‘ Ã‰ admin: ${ehAdmin ? 'SIM' : 'NÃƒO'}`);
                
                log('âœ… Teste de permissÃµes concluÃ­do', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro ao testar permissÃµes: ${error.message}`, 'error');
            }
        }

        function simularLogin() {
            log('ğŸ§ª Simulando login...');
            testesExecutados++;
            
            try {
                if (typeof Auth === 'undefined') {
                    throw new Error('Auth.js nÃ£o carregado');
                }
                
                // Simular login com usuÃ¡rio de teste
                Auth.state.usuario = {
                    email: 'teste@biapo.com.br',
                    displayName: 'UsuÃ¡rio de Teste',
                    admin: true
                };
                
                Auth.state.logado = true;
                
                // Atualizar App.js se disponÃ­vel
                if (typeof App !== 'undefined') {
                    App.usuarioAtual = Auth.state.usuario;
                    App.estadoSistema.usuarioAutenticado = true;
                    App.estadoSistema.modoAnonimo = false;
                }
                
                log('âœ… Login simulado com sucesso', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro ao simular login: ${error.message}`, 'error');
            }
        }

        function testarCalendario() {
            log('ğŸ§ª Testando funcionalidades do calendÃ¡rio...');
            testesExecutados++;
            
            try {
                if (typeof Calendar === 'undefined') {
                    throw new Error('Calendar.js nÃ£o carregado');
                }
                
                // Testar inicializaÃ§Ã£o
                const inicializado = Calendar.inicializar();
                log(`ğŸ“… CalendÃ¡rio inicializado: ${inicializado ? 'SIM' : 'NÃƒO'}`);
                
                // Testar atualizaÃ§Ã£o
                Calendar.atualizarEventos();
                log('âœ… CalendÃ¡rio atualizado');
                
                log('âœ… Teste do calendÃ¡rio concluÃ­do', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro ao testar calendÃ¡rio: ${error.message}`, 'error');
            }
        }

        function verificarIntegracaoCalendario() {
            log('ğŸ§ª Verificando integraÃ§Ã£o com calendÃ¡rio...');
            testesExecutados++;
            
            try {
                if (typeof Calendar === 'undefined') {
                    throw new Error('Calendar.js nÃ£o carregado');
                }
                
                // Verificar se estÃ¡ escutando eventos do App.js
                const status = Calendar.obterStatus();
                log(`ğŸ“Š Status do calendÃ¡rio: ${status.versao}`);
                log(`ğŸ“Š Carregado: ${status.carregado ? 'SIM' : 'NÃƒO'}`);
                
                // Verificar se tem funÃ§Ã£o de atualizaÃ§Ã£o
                if (typeof Calendar.atualizarEventos === 'function') {
                    log('âœ… FunÃ§Ã£o atualizarEventos disponÃ­vel', 'success');
                } else {
                    log('âŒ FunÃ§Ã£o atualizarEventos nÃ£o encontrada', 'error');
                }
                
                log('âœ… VerificaÃ§Ã£o de integraÃ§Ã£o concluÃ­da', 'success');
                testesSucesso++;
                
            } catch (error) {
                log(`âŒ Erro ao verificar integraÃ§Ã£o: ${error.message}`, 'error');
            }
        }

        function limparDadosTeste() {
            log('ğŸ§ª Limpando dados de teste...');
            
            try {
                // Limpar localStorage
                localStorage.removeItem('biapo_eventos');
                localStorage.removeItem('biapo_eventos_timestamp');
                localStorage.removeItem('biapo_dados_v8');
                localStorage.removeItem('biapo_dados_timestamp');
                
                // Reinicializar App se disponÃ­vel
                if (typeof App !== 'undefined' && App.init) {
                    App.init();
                }
                
                log('âœ… Dados de teste removidos', 'success');
                
            } catch (error) {
                log(`âŒ Erro ao limpar dados: ${error.message}`, 'error');
            }
        }

        async function executarTesteCompleto() {
            log('ğŸš€ Iniciando teste completo de integraÃ§Ã£o...');
            
            // Reset contadores
            testesExecutados = 0;
            testesSucesso = 0;
            
            // Executar todos os testes
            await testarCriacaoEventos();
            testarModalEvento();
            await testarSincronizacao();
            verificarEventos();
            testarPermissoes();
            simularLogin();
            testarCalendario();
            verificarIntegracaoCalendario();
            
            // Resultado final
            const percentual = Math.round((testesSucesso / testesExecutados) * 100);
            log(`ğŸ“Š RESULTADO FINAL: ${testesSucesso}/${testesExecutados} testes passaram (${percentual}%)`, 
                percentual >= 80 ? 'success' : 'warning');
            
            if (percentual >= 80) {
                log('ğŸ‰ Sistema BIAPO v8.12.2 - IntegraÃ§Ã£o FUNCIONANDO PERFEITAMENTE!', 'success');
            } else {
                log('âš ï¸ Alguns problemas foram detectados na integraÃ§Ã£o', 'warning');
            }
        }

        // Inicializar
        window.addEventListener('load', () => {
            log('ğŸš€ PÃ¡gina carregada - iniciando verificaÃ§Ã£o de integraÃ§Ã£o...');
            
            // Aguardar carregamento dos mÃ³dulos
            setTimeout(() => {
                atualizarStatusModulos();
                log('âœ… Status dos mÃ³dulos atualizado');
            }, 1000);
        });

        // Atualizar status periodicamente
        setInterval(atualizarStatusModulos, 3000);
    </script>
</body>
</html> 