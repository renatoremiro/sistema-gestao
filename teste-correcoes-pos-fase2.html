<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Corre√ß√µes P√≥s Fase 02 - BIAPO v8.13.0</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .teste-item {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            margin-left: 10px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste Corre√ß√µes P√≥s Fase 02 - BIAPO v8.13.0</h1>
        <p>Verifica√ß√£o das corre√ß√µes r√°pidas implementadas</p>
        
        <div class="teste-item">
            <h3>1. Verificar Calendar.js</h3>
            <div id="teste-calendar">
                <button onclick="verificarCalendar()">Verificar Calendar</button>
                <div id="resultado-calendar"></div>
            </div>
        </div>
        
        <div class="teste-item">
            <h3>2. Verificar minhaAgenda</h3>
            <div id="teste-minhaagenda">
                <button onclick="verificarMinhaAgenda()">Verificar minhaAgenda</button>
                <div id="resultado-minhaagenda"></div>
            </div>
        </div>
        
        <div class="teste-item">
            <h3>3. Verificar API Unificada</h3>
            <div id="teste-api">
                <button onclick="verificarAPI()">Verificar API Unificada</button>
                <div id="resultado-api"></div>
            </div>
        </div>
        
        <div class="teste-item">
            <h3>4. Teste de Cria√ß√£o de Tarefa</h3>
            <div id="teste-criacao">
                <button onclick="testarCriacaoTarefa()">Testar Cria√ß√£o de Tarefa</button>
                <div id="resultado-criacao"></div>
            </div>
        </div>
        
        <div class="teste-item">
            <h3>5. Log de Execu√ß√£o</h3>
            <div id="log-execucao" class="log"></div>
        </div>
        
        <div class="teste-item">
            <h3>6. Teste Completo</h3>
            <button onclick="executarTesteCompleto()">Executar Todos os Testes</button>
            <div id="resultado-completo"></div>
        </div>
    </div>

    <!-- Carregar scripts do sistema -->
    <script src="assets/js/config/firebase.js"></script>
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/validation.js"></script>
    <script src="assets/js/utils/notifications.js"></script>
    <script src="assets/js/utils/persistence.js"></script>
    <script src="assets/js/modules/auth.js"></script>
    <script src="assets/js/modules/events.js"></script>
    <script src="assets/js/modules/calendar.js"></script>
    <script src="assets/js/core/data.js"></script>
    <script src="assets/js/core/app.js"></script>
    <script src="assets/js/modules/biapo-v8130.js"></script>
    <script src="assets/js/utils/diagnostico_sistema.js"></script>
    <script src="assets/js/core/api-unificada.js"></script>

    <script>
        // Sistema de Log
        function log(mensagem, tipo = 'info') {
            const logDiv = document.getElementById('log-execucao');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const prefix = tipo === 'error' ? '‚ùå' : tipo === 'success' ? '‚úÖ' : tipo === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logDiv.innerHTML += `[${timestamp}] ${prefix} ${mensagem}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${mensagem}`);
        }

        // 1. Verificar Calendar.js
        function verificarCalendar() {
            log('Verificando Calendar.js...', 'info');
            const resultado = document.getElementById('resultado-calendar');
            
            try {
                const calendarExiste = typeof Calendar !== 'undefined';
                const obterStatusExiste = typeof Calendar?.obterStatus === 'function';
                
                if (calendarExiste && obterStatusExiste) {
                    const status = Calendar.obterStatus();
                    resultado.innerHTML = `
                        <span class="status success">CALENDAR FUNCIONANDO</span>
                        <p>Status: ${JSON.stringify(status)}</p>
                    `;
                    log('Calendar.js funcionando corretamente', 'success');
                } else {
                    resultado.innerHTML = `
                        <span class="status error">CALENDAR COM PROBLEMAS</span>
                        <p>Calendar existe: ${calendarExiste}</p>
                        <p>obterStatus existe: ${obterStatusExiste}</p>
                    `;
                    log('Calendar.js com problemas', 'error');
                }
            } catch (error) {
                resultado.innerHTML = `<span class="status error">ERRO: ${error.message}</span>`;
                log(`Erro ao verificar Calendar: ${error.message}`, 'error');
            }
        }

        // 2. Verificar minhaAgenda
        function verificarMinhaAgenda() {
            log('Verificando minhaAgenda...', 'info');
            const resultado = document.getElementById('resultado-minhaagenda');
            
            try {
                const minhaAgendaExiste = typeof minhaAgenda !== 'undefined';
                
                if (minhaAgendaExiste) {
                    const funcoes = [
                        'alternarVisualizacao',
                        'aplicarFiltros',
                        'navegarSemana',
                        'irParaHoje',
                        'mostrarModalNovaTarefaFase4'
                    ];
                    
                    const funcoesExistem = funcoes.every(f => typeof minhaAgenda[f] === 'function');
                    
                    resultado.innerHTML = `
                        <span class="status success">MINHA AGENDA FUNCIONANDO</span>
                        <p>Fun√ß√µes dispon√≠veis: ${funcoesExistem ? 'Todas' : 'Parcialmente'}</p>
                    `;
                    log('minhaAgenda funcionando corretamente', 'success');
                } else {
                    resultado.innerHTML = `<span class="status error">MINHA AGENDA N√ÉO ENCONTRADA</span>`;
                    log('minhaAgenda n√£o encontrada', 'error');
                }
            } catch (error) {
                resultado.innerHTML = `<span class="status error">ERRO: ${error.message}</span>`;
                log(`Erro ao verificar minhaAgenda: ${error.message}`, 'error');
            }
        }

        // 3. Verificar API Unificada
        function verificarAPI() {
            log('Verificando API Unificada...', 'info');
            const resultado = document.getElementById('resultado-api');
            
            try {
                const apiExiste = typeof APIUnificada !== 'undefined';
                
                if (apiExiste) {
                    const status = APIUnificada.obterStatusCompleto();
                    resultado.innerHTML = `
                        <span class="status success">API UNIFICADA FUNCIONANDO</span>
                        <p>Vers√£o: ${status.versao}</p>
                        <p>Timestamp: ${status.timestamp}</p>
                    `;
                    log('API Unificada funcionando corretamente', 'success');
                } else {
                    resultado.innerHTML = `<span class="status error">API UNIFICADA N√ÉO ENCONTRADA</span>`;
                    log('API Unificada n√£o encontrada', 'error');
                }
            } catch (error) {
                resultado.innerHTML = `<span class="status error">ERRO: ${error.message}</span>`;
                log(`Erro ao verificar API: ${error.message}`, 'error');
            }
        }

        // 4. Testar cria√ß√£o de tarefa
        async function testarCriacaoTarefa() {
            log('Testando cria√ß√£o de tarefa...', 'info');
            const resultado = document.getElementById('resultado-criacao');
            
            try {
                if (typeof APIUnificada === 'undefined') {
                    throw new Error('API Unificada n√£o dispon√≠vel');
                }
                
                const tarefa = await APIUnificada.criarTarefa({
                    titulo: 'Teste Corre√ß√µes P√≥s Fase 02',
                    descricao: 'Tarefa criada para testar corre√ß√µes',
                    tipo: 'pessoal',
                    dataInicio: new Date().toISOString().split('T')[0]
                });
                
                resultado.innerHTML = `
                    <span class="status success">TAREFA CRIADA COM SUCESSO</span>
                    <p>ID: ${tarefa.id}</p>
                    <p>T√≠tulo: ${tarefa.titulo}</p>
                `;
                log('Tarefa criada com sucesso via API Unificada', 'success');
                
            } catch (error) {
                resultado.innerHTML = `<span class="status error">ERRO: ${error.message}</span>`;
                log(`Erro ao criar tarefa: ${error.message}`, 'error');
            }
        }

        // 5. Teste completo
        async function executarTesteCompleto() {
            log('=== INICIANDO TESTE COMPLETO P√ìS CORRE√á√ïES ===', 'info');
            const resultado = document.getElementById('resultado-completo');
            
            const testes = [
                { nome: 'Calendar.js', funcao: verificarCalendar },
                { nome: 'minhaAgenda', funcao: verificarMinhaAgenda },
                { nome: 'API Unificada', funcao: verificarAPI },
                { nome: 'Cria√ß√£o de Tarefa', funcao: testarCriacaoTarefa }
            ];
            
            let sucessos = 0;
            let total = testes.length;
            
            for (let i = 0; i < testes.length; i++) {
                const teste = testes[i];
                log(`Executando teste ${i + 1}/${total}: ${teste.nome}`, 'info');
                
                try {
                    await teste.funcao();
                    sucessos++;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } catch (error) {
                    log(`Erro no teste ${teste.nome}: ${error.message}`, 'error');
                }
            }
            
            const porcentagem = (sucessos / total) * 100;
            const status = porcentagem >= 90 ? 'EXCELENTE' : 
                          porcentagem >= 75 ? 'BOM' : 
                          porcentagem >= 60 ? 'REGULAR' : 'CR√çTICO';
            
            resultado.innerHTML = `
                <h3>RESULTADO FINAL</h3>
                <span class="status ${status === 'EXCELENTE' ? 'success' : status === 'BOM' ? 'info' : status === 'REGULAR' ? 'warning' : 'error'}">
                    ${status} (${porcentagem.toFixed(1)}%)
                </span>
                <p>‚úÖ Sucessos: ${sucessos}/${total}</p>
            `;
            
            log(`=== TESTE COMPLETO FINALIZADO: ${status} (${sucessos}/${total}) ===`, 'success');
        }

        // Auto-executar quando p√°gina carregar
        window.addEventListener('load', () => {
            log('P√°gina carregada, aguardando inicializa√ß√£o...', 'info');
            
            setTimeout(() => {
                log('Sistema carregado, pronto para testes!', 'success');
            }, 3000);
        });
    </script>
</body>
</html> 